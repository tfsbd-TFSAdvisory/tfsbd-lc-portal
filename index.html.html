<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TFSBD – LC Application Portal</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
:root {
  --primary:#34495E; --secondary:#3498db; --success:#27ae60;
  --warning:#f39c12; --danger:#e74c3c; --light:#ecf0f1; --dark:#2c3e50;
  --navy:#0a1628; --navy2:#132040; --gold:#c9a84c; --gold2:#e8c96d;
  --cream:#f5f0e8; --cream2:#ede6d6; --border:#d4c9b0;
  --green:#1a6b3a; --muted:#6b7280; --red:#c0392b;
  --agent-bg:#e3f2fd; --owner-bg:#fff3e0;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:verdana,Tahoma,Geneva,sans-serif}
body{background:#f5f7fa;color:#333;line-height:1.6}

/* ── TOP BAR ── */
.top-bar{background:var(--navy);padding:12px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid var(--gold)}
.tfsbd-brand{display:flex;align-items:center;gap:12px}
.tfsbd-logo{width:42px;height:42px;background:var(--gold);border-radius:6px;display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-weight:700;color:var(--navy);font-size:17px;flex-shrink:0}
.tfsbd-text strong{font-family:'Playfair Display',serif;font-size:15px;color:white;display:block;letter-spacing:.3px}
.tfsbd-text span{font-size:10px;color:rgba(255,255,255,.45);letter-spacing:1.5px;text-transform:uppercase}
.topbar-right{display:flex;align-items:center;gap:15px}
#pageSubtitle-display{color:rgba(255,255,255,.5);font-size:11px;letter-spacing:.5px}
.user-badge{background:rgba(201,168,76,.15);color:var(--gold);padding:5px 12px;border-radius:20px;font-size:11px;font-weight:bold;display:flex;align-items:center;gap:6px;border:1px solid rgba(201,168,76,.3)}
.user-badge i{font-size:10px}
.btn-logout{padding:7px 14px;background:transparent;border:1.5px solid rgba(255,255,255,.25);color:white;border-radius:5px;font-size:11px;font-weight:bold;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all .15s}
.btn-logout:hover{border-color:var(--gold);color:var(--gold)}

/* ── PANEL INDICATOR ── */
.panel-indicator{background:linear-gradient(135deg, var(--navy2), #1a2c4a);padding:5px 20px;color:white;font-size:11px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(201,168,76,.2)}
.panel-badge{display:flex;align-items:center;gap:8px}
.panel-tag{padding:3px 10px;border-radius:15px;font-weight:bold;font-size:10px;text-transform:uppercase;letter-spacing:1px}
.panel-tag.admin{background:var(--gold);color:var(--navy)}
.panel-tag.customer{background:var(--secondary);color:white}
.panel-switch{display:flex;gap:5px}
.panel-btn{padding:3px 12px;border-radius:15px;background:rgba(255,255,255,.1);color:rgba(255,255,255,.7);border:none;font-size:10px;cursor:pointer;transition:all .15s}
.panel-btn.active{background:var(--gold);color:var(--navy);font-weight:bold}
.panel-btn:hover{background:rgba(255,255,255,.2)}

/* ── NAV ── */
.nav-container{background:white;padding:8px 20px;border-bottom:2px ridge var(--primary);display:flex;align-items:center;flex-wrap:wrap;gap:4px}
.leftnav,.leftnavon{padding:7px 14px;font-family:verdana;font-weight:bold;font-size:12px;border:2px var(--primary) ridge;margin:2px;display:inline-flex;align-items:center;gap:6px;cursor:pointer;text-decoration:none;border-radius:4px;transition:all .15s}
.leftnav{background:white;color:black}
.leftnav:hover{background:#f0f0f0}
.leftnavon{background:#fef3cd;color:var(--dark);border-color:var(--gold)}
.nav-swift{border-color:var(--gold)!important;color:var(--navy)!important}
.nav-swift.leftnavon{background:var(--gold)!important;color:var(--navy)!important}
.swift-dot{width:7px;height:7px;border-radius:50%;background:var(--gold);display:inline-block;animation:pulse 1.8s infinite}
.nav-swift.leftnavon .swift-dot{background:var(--navy)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* ── CONTENT ── */
.content-area{padding:15px 20px}

/* ── REGISTRATION BANNER ── */
.reg-banner{background:linear-gradient(135deg, #fff3cd, #fff9e6);border-left:4px solid var(--gold);padding:15px 20px;margin-bottom:20px;border-radius:0 8px 8px 0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px}
.reg-banner-text{display:flex;align-items:center;gap:15px;flex-wrap:wrap}
.reg-banner-text i{font-size:24px;color:var(--gold)}
.reg-banner-text strong{color:var(--navy);font-size:14px}
.reg-banner-text p{color:#856404;font-size:12px;margin:2px 0 0}
.reg-banner-btn{background:var(--gold);color:var(--navy);border:none;padding:8px 20px;border-radius:5px;font-weight:bold;font-size:12px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:all .15s}
.reg-banner-btn:hover{background:var(--gold2);transform:translateY(-2px);box-shadow:0 4px 8px rgba(201,168,76,.3)}

/* ── PORTAL STYLES ── */
.datacard{border:2px solid #ccc;margin-top:15px;width:100%;background:white;border-collapse:collapse;box-shadow:0 2px 5px rgba(0,0,0,.1)}
.datacardtitle{background:var(--primary);color:white;font-family:verdana;font-weight:bold;font-size:13px;padding:10px;border-bottom:2px solid #ccc}
.datacard td{padding:10px;border-bottom:1px solid #e0e0e0;font-size:13px}
.datacard tr:last-child td{border-bottom:none}
.calendartitle{background:var(--primary);color:white;font-family:verdana;font-weight:bold;font-size:12px;padding:10px;margin-top:20px;border:2px solid #ccc;border-bottom:none}
.calendarlist{border:2px solid #ccc;border-top:none;padding:15px;background:white;list-style-type:none}
.calendarlist li{padding:8px 0;border-bottom:1px dashed #ddd;font-size:12px}
.calendarlist li:last-child{border-bottom:none}
.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin-top:15px}
.status-badge{padding:4px 10px;border-radius:3px;font-size:11px;font-weight:bold;display:inline-block}
.status-draft{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}
.status-submitted{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}
.status-approved{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.status-rejected{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
.btn{padding:7px 14px;border:none;border-radius:4px;font-size:12px;font-weight:bold;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:5px;text-decoration:none;font-family:verdana;margin:2px;transition:all .15s}
.btn-primary{background:var(--secondary);color:white;border:2px ridge var(--secondary)}
.btn-primary:hover{background:#2980b9}
.btn-outline{background:transparent;border:2px ridge var(--secondary);color:var(--secondary)}
.btn-outline:hover{background:var(--secondary);color:white}
.btn-gold{background:var(--gold);color:var(--navy)}
.btn-gold:hover{background:var(--gold2)}

/* ── REGISTRATION FORM ── */
.reg-form{max-width:600px;margin:0 auto;background:white;border-radius:10px;padding:30px;box-shadow:0 5px 20px rgba(0,0,0,.1)}
.reg-form h3{color:var(--navy);font-family:'Playfair Display',serif;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid var(--gold)}
.reg-form .form-group{margin-bottom:20px}
.reg-form label{display:block;font-size:12px;font-weight:bold;color:var(--navy);margin-bottom:5px}
.reg-form input,.reg-form select{padding:12px;border:1.5px solid var(--border);border-radius:6px;font-size:13px;width:100%}
.reg-form input:focus,.reg-form select:focus{border-color:var(--gold);outline:none}
.logo-upload{border:2px dashed var(--border);border-radius:8px;padding:20px;text-align:center;background:var(--cream);cursor:pointer;position:relative}
.logo-upload:hover{border-color:var(--gold);background:#fef9ef}
.logo-upload input{position:absolute;inset:0;opacity:0;cursor:pointer}
.logo-preview{max-width:120px;max-height:120px;margin:10px auto;display:none}
.logo-preview img{max-width:100%;max-height:100%;border-radius:8px}

/* ── USER TYPE BADGE ── */
.user-type-badge{padding:3px 8px;border-radius:4px;font-size:10px;font-weight:bold}
.user-agent{background:var(--agent-bg);color:#0d47a1}
.user-owner{background:var(--owner-bg);color:#bf360c}

/* ════════════════════════════════════════════════
   TRADE QUOTE FORM (from TradeQuote.html)
   ════════════════════════════════════════════════ */
.trade-quote-container{background:white;border-radius:10px;padding:25px;box-shadow:0 2px 8px rgba(10,22,40,.07)}
.trade-quote-header{margin-bottom:25px;border-bottom:2px solid var(--gold);padding-bottom:15px}
.trade-quote-header h2{color:var(--navy);font-family:'Playfair Display',serif;font-size:22px}
.trade-quote-header p{color:var(--muted);font-size:13px;margin-top:5px}
.tq-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
.tq-full{grid-column:1/-1}
.tq-section-title{font-size:16px;color:var(--navy);margin:20px 0 15px;font-weight:600}
.tq-label{font-size:12px;font-weight:600;color:var(--navy);margin-bottom:5px;display:block}
.tq-required{color:var(--red);margin-left:3px}
.tq-input,.tq-select,.tq-textarea{padding:10px;border:1.5px solid var(--border);border-radius:6px;width:100%;font-size:13px}
.tq-input:focus,.tq-select:focus,.tq-textarea:focus{border-color:var(--gold);outline:none}
.tq-file-upload{border:2px dashed var(--border);border-radius:8px;padding:25px;text-align:center;background:var(--cream);cursor:pointer;position:relative}
.tq-file-upload:hover{border-color:var(--gold);background:#fef9ef}
.tq-file-upload input{position:absolute;inset:0;opacity:0;cursor:pointer}
.tq-currency-row{display:flex;gap:10px}
.tq-currency-row select{width:130px}
.tq-currency-row input{flex:1}
.tq-submit{background:var(--green);color:white;padding:12px 30px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;margin-top:30px;font-size:14px}
.tq-submit:hover{background:#1e7d42}

/* ════════════════════════════════════════════════
   PROJECT FINANCE FORM (from projectfinance.html)
   ════════════════════════════════════════════════ */
.pf-container{background:white;border-radius:10px;padding:25px;box-shadow:0 2px 8px rgba(10,22,40,.07)}
.pf-header{text-align:center;margin-bottom:25px}
.pf-header h2{color:var(--navy);font-family:'Playfair Display',serif;font-size:24px}
.pf-header h3{color:var(--muted);font-size:14px;font-weight:400;margin-top:5px}
.pf-alert{background:#fffb ea;border-left:4px solid #f6e05e;color:#b7791f;padding:15px;margin-bottom:25px;border-radius:4px;font-size:13px}
.pf-alert strong{display:block;margin-bottom:5px;font-size:14px}
.pf-section{margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid var(--border)}
.pf-section-title{color:var(--navy);font-size:18px;margin-bottom:20px}
.pf-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
.pf-group{display:flex;flex-direction:column}
.pf-group.full{grid-column:1/-1}
.pf-label{font-weight:600;margin-bottom:8px;color:var(--navy);font-size:13px}
.pf-sub{font-size:11px;color:var(--muted);margin-top:-5px;margin-bottom:8px}
.pf-checkbox-group{display:flex;flex-direction:column;gap:12px}
.pf-checkbox-item{display:flex;align-items:flex-start;gap:10px;font-size:13px}
.pf-checkbox-desc strong{color:var(--navy);display:block;font-size:12px}
.pf-dates{display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px}
.pf-terms{background:#f8fafc;padding:20px;border:1px solid var(--border);border-radius:6px;height:150px;overflow-y:auto;font-size:12px;color:#555;margin-bottom:15px}
.pf-buttons{display:flex;justify-content:flex-end;gap:15px;margin-top:30px}
.pf-btn-view{background:#e2e8f0;color:var(--navy);padding:12px 24px;border:none;border-radius:6px;font-weight:600;cursor:pointer}
.pf-btn-submit{background:var(--green);color:white;padding:12px 24px;border:none;border-radius:6px;font-weight:600;cursor:pointer}
.pf-btn-submit:hover{background:#1e7d42}

/* ════════════════════════════════════════════════
   SWIFT GENERATOR STYLES (Full Version)
   ════════════════════════════════════════════════ */
#swift-generator{font-family:'IBM Plex Sans',sans-serif}
.sg-header{background:var(--navy2);border-radius:10px;padding:22px 26px;margin-bottom:20px;position:relative;overflow:hidden}
.sg-header::before{content:'';position:absolute;top:0;right:0;width:300px;height:100%;background:linear-gradient(135deg,transparent 40%,rgba(201,168,76,.07));pointer-events:none}
.sg-header-inner{display:flex;align-items:center;gap:16px}
.sg-icon{width:48px;height:48px;background:linear-gradient(135deg,var(--gold),var(--gold2));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.sg-header h2{font-family:'Playfair Display',serif;font-size:20px;color:white;font-weight:700;margin-bottom:3px}
.sg-header p{color:rgba(255,255,255,.45);font-size:12px}

.sg-section{background:white;border-radius:10px;padding:20px 24px;margin-bottom:16px;border:1px solid var(--border);box-shadow:0 2px 8px rgba(10,22,40,.07)}
.sg-section-title{font-family:'Playfair Display',serif;font-size:14px;font-weight:700;color:var(--navy);margin-bottom:14px;padding-bottom:10px;border-bottom:1.5px solid var(--cream2);display:flex;align-items:center;gap:8px}
.sg-section-title .step-tag{font-family:'IBM Plex Mono',monospace;font-size:11px;background:var(--navy);color:var(--gold);padding:2px 8px;border-radius:4px;font-weight:500}

.sg-grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.sg-grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
.sg-full{grid-column:1/-1}

.field-group{display:flex;flex-direction:column;gap:5px}
.field-label{font-size:11px;font-weight:600;color:var(--navy);letter-spacing:.5px;text-transform:uppercase;display:flex;align-items:center;gap:5px;flex-wrap:wrap}
.badge-m{background:#fef3cd;color:#856404;font-size:10px;padding:1px 5px;border-radius:3px;font-weight:700}
.badge-o{background:#e8f5e9;color:#2e7d32;font-size:10px;padding:1px 5px;border-radius:3px;font-weight:700}
.field-help{font-size:10px;color:var(--muted);font-style:italic;margin-top:2px}
.auto-tag{font-size:9px;background:#e3f2fd;color:#1565c0;padding:1px 6px;border-radius:3px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}

#swift-generator select,
#swift-generator input[type=text],
#swift-generator input[type=email],
#swift-generator input[type=date],
#swift-generator input[type=number],
#swift-generator textarea{
  font-family:'IBM Plex Sans',sans-serif;font-size:13px;
  border:1.5px solid var(--border);border-radius:6px;
  padding:8px 11px;background:var(--cream);color:#1a1a2e;
  width:100%;transition:border-color .2s,box-shadow .2s;outline:none;
}
#swift-generator select:focus,
#swift-generator input:focus,
#swift-generator textarea:focus{
  border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,76,.15);background:white;
}
#swift-generator textarea{resize:vertical;min-height:72px;line-height:1.5}
#swift-generator input[readonly]{background:#f0f0f0;cursor:not-allowed}
.swift-preview{display:none;font-family:'IBM Plex Mono',monospace;font-size:11px;background:var(--navy);color:var(--gold2);padding:5px 10px;border-radius:5px;letter-spacing:1px;margin-top:3px;width:fit-content}
.category-label{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);margin:12px 0 8px;display:flex;align-items:center;gap:8px}
.category-label::after{content:'';flex:1;border-top:1px solid var(--cream2)}

/* Upload box */
.upload-box{border:2px dashed var(--border);border-radius:8px;padding:18px;text-align:center;background:var(--cream);cursor:pointer;transition:all .2s;position:relative}
.upload-box:hover,.upload-box.drag-over{border-color:var(--gold);background:#fef9ef}
.upload-box input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.upload-box .ub-icon{font-size:28px;margin-bottom:6px;color:var(--gold)}
.upload-box p{font-size:12px;color:var(--muted);margin:0}
.upload-box strong{font-size:13px;color:var(--navy)}
.upload-status{font-size:11px;margin-top:6px;padding:5px 10px;border-radius:5px;display:none}
.upload-status.success{background:#d4edda;color:#155724;display:block}
.upload-status.processing{background:#d1ecf1;color:#0c5460;display:block}
.autofill-note{font-size:10px;color:var(--green);font-style:italic;margin-top:3px;display:none}

/* Input-combo (dropdown + text toggle) */
.input-combo{display:flex;flex-direction:column;gap:6px}
.input-combo-row{display:flex;gap:6px;align-items:center}
.input-combo-row select{flex:1}
.toggle-manual{font-size:10px;color:var(--secondary);cursor:pointer;text-decoration:underline;white-space:nowrap;background:none;border:none;font-family:'IBM Plex Sans',sans-serif;padding:0}
.toggle-manual:hover{color:var(--navy)}
.manual-input{display:none}

/* Mixed row (inline elements side by side) */
.inline-row{display:flex;gap:8px;align-items:flex-end}
.inline-row > *{flex:1}
.inline-row > .flex-fixed{flex:0 0 auto}

/* Documents required — structured fillable */
.doc-item{background:var(--cream);border:1px solid var(--border);border-radius:7px;padding:12px 14px;margin-bottom:10px}
.doc-item-header{font-size:11px;font-weight:700;color:var(--navy);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.doc-item-header .doc-letter{width:22px;height:22px;background:var(--navy);color:var(--gold);border-radius:4px;display:inline-flex;align-items:center;justify-content:center;font-family:'IBM Plex Mono',monospace;font-size:11px;font-weight:700;flex-shrink:0}
.doc-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.doc-grid .full{grid-column:1/-1}

/* Additional conditions — structured */
.cond-item{border-left:3px solid var(--gold);padding:8px 12px;margin-bottom:8px;background:#fdfaf4;border-radius:0 6px 6px 0}
.cond-item-num{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px}

/* Action buttons */
.sg-actions{background:var(--navy2);border-radius:10px;padding:16px 22px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;border:1px solid rgba(201,168,76,.2)}
.actions-label{font-size:11px;color:rgba(255,255,255,.4);letter-spacing:1px;text-transform:uppercase;margin-right:4px;white-space:nowrap}
.sg-btn{display:inline-flex;align-items:center;gap:7px;padding:9px 18px;border-radius:7px;font-family:'IBM Plex Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;border:none;transition:all .15s}
.sg-btn-view{background:white;color:var(--navy);border:1.5px solid var(--border)}
.sg-btn-view:hover{background:var(--cream2);border-color:var(--gold)}
.sg-btn-save{background:var(--gold);color:var(--navy)}
.sg-btn-save:hover{background:var(--gold2);transform:translateY(-1px);box-shadow:0 4px 12px rgba(201,168,76,.3)}
.sg-btn-print{background:transparent;color:white;border:1.5px solid rgba(255,255,255,.2)}
.sg-btn-print:hover{border-color:var(--gold);color:var(--gold)}
.sg-btn-send{background:var(--green);color:white}
.sg-btn-send:hover{background:#1e7d42;transform:translateY(-1px);box-shadow:0 4px 12px rgba(26,107,58,.25)}
.sg-btn svg{width:14px;height:14px}

/* Validation */
.error-msg{font-size:10px;color:var(--red);margin-top:2px;display:none}
.field-group.has-error select,.field-group.has-error input,.field-group.has-error textarea{border-color:var(--red)!important}
.field-group.has-error .error-msg{display:block}

/* ── MODALS ── */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(10,22,40,.72);z-index:1000;align-items:center;justify-content:center;padding:20px}
.modal-overlay.active{display:flex;animation:fadeIn .2s}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:white;border-radius:12px;width:100%;max-width:820px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 20px 70px rgba(0,0,0,.3)}
.modal-toolbar{background:var(--navy);padding:13px 18px;display:flex;align-items:center;justify-content:space-between}
.modal-toolbar span{color:white;font-size:13px;font-weight:600;font-family:'Playfair Display',serif}
.modal-toolbar-btns{display:flex;gap:7px}
.modal-close{background:rgba(255,255,255,.12);color:white;border:none;padding:5px 12px;border-radius:5px;cursor:pointer;font-size:11px;font-family:'IBM Plex Sans',sans-serif;font-weight:600}
.modal-close:hover{background:rgba(255,255,255,.22)}
.modal-body{overflow-y:auto;padding:0}
.email-modal{background:white;border-radius:12px;width:100%;max-width:460px;overflow:hidden;box-shadow:0 20px 70px rgba(0,0,0,.3)}
.email-modal-header{background:var(--navy);padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
.email-modal-header span{color:white;font-size:13px;font-weight:600;font-family:'Playfair Display',serif}
.email-modal-body{padding:22px 20px;display:flex;flex-direction:column;gap:14px}
.email-modal-footer{padding:14px 20px;background:var(--cream);display:flex;gap:10px;justify-content:flex-end;border-top:1px solid var(--border)}

/* ── DRAFT DOCUMENT ── */
.draft-doc{font-family:'IBM Plex Sans',sans-serif}
.draft-header{background:var(--navy);padding:22px 30px;display:flex;align-items:center;gap:16px}
.draft-logo{width:46px;height:46px;background:var(--gold);border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-weight:700;color:var(--navy);font-size:18px;flex-shrink:0}
.draft-header-text strong{font-family:'Playfair Display',serif;font-size:15px;color:white;display:block}
.draft-header-text span{font-size:10px;color:rgba(255,255,255,.45);letter-spacing:1.5px;text-transform:uppercase}
.draft-watermark{background:rgba(201,168,76,.08);border:1px solid rgba(201,168,76,.25);padding:6px;text-align:center;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#856404;font-family:'IBM Plex Mono',monospace}
.draft-content{padding:22px 30px}
.draft-meta{display:flex;gap:18px;margin-bottom:16px;flex-wrap:wrap}
.draft-meta-item{font-size:11px;color:var(--muted)}
.draft-meta-item strong{color:var(--navy);display:block;font-size:10px;text-transform:uppercase;letter-spacing:.5px;margin-bottom:1px}
.swift-block{font-family:'IBM Plex Mono',monospace;font-size:11.5px;background:var(--navy);color:#e2f0ff;padding:18px 22px;border-radius:9px;white-space:pre-wrap;word-break:break-word;line-height:1.85;border-left:4px solid var(--gold)}
.draft-footer{background:var(--navy2);padding:16px 30px;border-top:1px solid rgba(201,168,76,.12)}
.draft-footer-top{font-size:11px;color:rgba(255,255,255,.55);margin-bottom:8px;font-style:italic}
.draft-footer-addr{display:flex;gap:28px;flex-wrap:wrap;margin-bottom:10px}
.draft-footer-addr div{font-size:10px;color:rgba(255,255,255,.4);line-height:1.7}
.draft-footer-addr strong{color:rgba(255,255,255,.65);display:block;font-size:9px;text-transform:uppercase;letter-spacing:.8px}
.social-links{display:flex;gap:8px}
.social-link{display:inline-flex;align-items:center;gap:4px;font-size:10px;color:rgba(255,255,255,.4);text-decoration:none;padding:3px 8px;border:1px solid rgba(255,255,255,.1);border-radius:4px;transition:all .15s}
.social-link:hover{border-color:var(--gold);color:var(--gold)}

/* Toast */
.toast{position:fixed;bottom:24px;right:24px;background:var(--green);color:white;padding:12px 20px;border-radius:9px;font-size:13px;font-weight:600;box-shadow:0 8px 28px rgba(0,0,0,.2);transform:translateY(80px);opacity:0;transition:all .3s;z-index:2000;display:flex;align-items:center;gap:9px;font-family:'IBM Plex Sans',sans-serif}
.toast.show{transform:translateY(0);opacity:1}

@media(max-width:700px){
  .tq-grid,.pf-row,.pf-dates{grid-template-columns:1fr}
  .panel-indicator{flex-direction:column;gap:8px;text-align:center}
  .reg-banner{flex-direction:column;text-align:center}
  .sg-grid2,.sg-grid3,.doc-grid{grid-template-columns:1fr}
  .sg-actions{flex-direction:column;align-items:stretch}
  .sg-btn{justify-content:center}
  .inline-row{flex-direction:column}
}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="top-bar">
  <div class="tfsbd-brand">
    <div class="tfsbd-logo">TF</div>
    <div class="tfsbd-text">
      <strong>Trade Finance Solution Bangladesh (TFSBD)</strong>
      <span>LC Application Portal &amp; Swift Message Generator</span>
    </div>
  </div>
  <div class="topbar-right">
    <div class="user-badge" id="userBadge" style="display:none">
      <i class="fas fa-user-circle"></i>
      <span id="userName">Guest</span>
      <span id="userTypeBadge" class="user-type-badge"></span>
    </div>
    <span id="pageSubtitle-display">Dashboard Overview</span>
    <button class="btn-logout" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
  </div>
</div>

<!-- PANEL INDICATOR -->
<div class="panel-indicator" id="panelIndicator">
  <div class="panel-badge">
    <span class="panel-tag customer" id="currentPanel">CUSTOMER PANEL</span>
    <span id="panelCompanyName"></span>
  </div>
  <div class="panel-switch">
    <button class="panel-btn active" onclick="switchPanel('customer')">Customer Panel</button>
    <button class="panel-btn" onclick="switchPanel('admin')">Admin Panel</button>
  </div>
</div>

<!-- REGISTRATION BANNER (shown to unregistered users) -->
<div class="reg-banner" id="regBanner">
  <div class="reg-banner-text">
    <i class="fas fa-id-card"></i>
    <div>
      <strong>Complete Your Registration</strong>
      <p>You're viewing as a guest. Register now to submit forms and track your applications.</p>
    </div>
  </div>
  <button class="reg-banner-btn" onclick="navigateTo('settings')">
    <i class="fas fa-arrow-right"></i> Register Now
  </button>
</div>

<!-- NAV -->
<div class="nav-container">
  <a class="leftnavon" data-page="dashboard"><i class="fas fa-th-large"></i> Dashboard</a>
  <a class="leftnav" data-page="trade-quote"><i class="fas fa-file-invoice"></i> Trade Quote</a>
  <a class="leftnav" data-page="applications"><i class="fas fa-file-contract"></i> My Applications</a>
  <a class="leftnav" data-page="company-info"><i class="fas fa-building"></i> Company Info</a>
  <a class="leftnav" data-page="lc-application"><i class="fas fa-file-invoice-dollar"></i> LC Application</a>
  <a class="leftnav" data-page="project-finance"><i class="fas fa-chart-line"></i> Project Finance</a>
  <a class="leftnav nav-swift" data-page="swift-generator">
    <span class="swift-dot"></span><i class="fas fa-paper-plane"></i> Swift Generator
  </a>
  <a class="leftnav" data-page="help"><i class="fas fa-question-circle"></i> Help</a>
  <a class="leftnav" data-page="settings"><i class="fas fa-cog"></i> Settings</a>
</div>

<div class="content-area">

<!-- DASHBOARD -->
<div id="dashboard" class="page-content">
  <div class="dashboard-grid">
    <table class="datacard">
      <tr><td colspan="2" class="datacardtitle"><i class="fas fa-building"></i> Company Information</td></tr>
      <tr><td>Company:</td><td><strong id="dashboardCompany">Not Registered</strong></td></tr>
      <tr><td>User Type:</td><td><span id="dashboardUserType">Guest</span></td></tr>
      <tr><td>Status:</td><td><span id="dashboardStatus">Registration Required</span></td></tr>
      <tr><td colspan="2" style="text-align:center;padding:14px">
        <button class="btn btn-primary" data-page="settings"><i class="fas fa-edit"></i> Complete Registration</button>
      </td></tr>
    </table>
    <table class="datacard">
      <tr><td colspan="2" class="datacardtitle"><i class="fas fa-file-contract"></i> Applications</td></tr>
      <tr><td>Trade Quotes:</td><td><strong id="dashboardQuotes">0</strong></td></tr>
      <tr><td>Project Finance:</td><td><strong id="dashboardProjects">0</strong></td></tr>
      <tr><td>LC Applications:</td><td><strong id="dashboardLCs">0</strong></td></tr>
      <tr><td colspan="2" style="text-align:center;padding:14px">
        <button class="btn btn-primary" data-page="trade-quote"><i class="fas fa-plus"></i> New Trade Quote</button>
      </td></tr>
    </table>
    <table class="datacard">
      <tr><td colspan="2" class="datacardtitle"><i class="fas fa-history"></i> Recent Activity</td></tr>
      <tr><td>Latest Quote:</td><td id="dashboardLatest">-</td></tr>
      <tr><td>Status:</td><td><span class="status-badge status-draft">Draft</span></td></tr>
      <tr><td>Date:</td><td id="dashboardDate">-</td></tr>
      <tr><td colspan="2" style="text-align:center;padding:14px">
        <button class="btn btn-primary" data-page="applications"><i class="fas fa-eye"></i> View All</button>
      </td></tr>
    </table>
  </div>
  <div class="calendartitle">Upcoming Tasks</div>
  <ul class="calendarlist" id="taskList">
    <li><i class="fas fa-clock"></i> Complete company registration – Today</li>
    <li><i class="fas fa-file-invoice"></i> Submit trade quote – Dec 15</li>
  </ul>
</div>

<!-- TRADE QUOTE (from TradeQuote.html) -->
<div id="trade-quote" class="page-content" style="display:none">
  <div class="trade-quote-container">
    <div class="trade-quote-header">
      <h2>Trade Quote Request</h2>
      <p>Please fill in the form below. Our team will verify the information and contact you shortly.</p>
    </div>
    
    <form id="tradeQuoteForm">
      <!-- Contact and Verification -->
      <div class="tq-section-title">Contact and Verification</div>
      <div class="tq-grid">
        <div>
          <label class="tq-label">First Name <span class="tq-required">*</span></label>
          <input type="text" class="tq-input" id="tq-firstName" required>
        </div>
        <div>
          <label class="tq-label">Last Name <span class="tq-required">*</span></label>
          <input type="text" class="tq-input" id="tq-lastName" required>
        </div>
        <div>
          <label class="tq-label">Email Address <span class="tq-required">*</span></label>
          <input type="email" class="tq-input" id="tq-email" required>
        </div>
        <div>
          <label class="tq-label">Mobile <span class="tq-required">*</span></label>
          <input type="tel" class="tq-input" id="tq-mobile" required placeholder="+880...">
        </div>
      </div>

      <!-- Transaction Details -->
      <div class="tq-section-title">Transaction Details</div>
      <div class="tq-grid">
        <div>
          <label class="tq-label">Type of Transaction</label>
          <select class="tq-select" id="tq-transactionType">
            <option>Letter of credit</option>
            <option>Stand by Letter of credit</option>
            <option>Bank Guarantee</option>
            <option>Trade Loan</option>
          </select>
        </div>
        <div>
          <label class="tq-label">Service Required</label>
          <select class="tq-select" id="tq-serviceRequired">
            <option>Confirmation and Discounting</option>
            <option>Discounting</option>
            <option>Refinancing</option>
          </select>
        </div>
        <div>
          <label class="tq-label">Issuing Bank Country</label>
          <select class="tq-select" id="tq-bankCountry">
            <option>Bangladesh</option>
          </select>
        </div>
        <div>
          <label class="tq-label">LC Issuing Bank</label>
          <select class="tq-select" id="tq-issuingBank">
            <option>BRAC Bank Limited</option>
            <option>Dutch-Bangla Bank Limited</option>
            <option>Eastern Bank Limited</option>
            <option>HSBC</option>
            <option>Standard Chartered Bank</option>
          </select>
        </div>
        <div>
          <label class="tq-label">Transaction Currency</label>
          <div class="tq-currency-row">
            <select class="tq-select" id="tq-currency">
              <option>USD</option>
              <option>EUR</option>
              <option>GBP</option>
              <option>BDT</option>
            </select>
            <input type="number" class="tq-input" id="tq-amount" placeholder="Amount">
          </div>
        </div>
        <div>
          <label class="tq-label">Tenor Type</label>
          <select class="tq-select" id="tq-tenorType">
            <option>At Sight</option>
            <option>Usance/Deferred</option>
          </select>
        </div>
        <div class="tq-full">
          <label class="tq-label">Goods Description</label>
          <textarea class="tq-textarea" id="tq-goodsDesc" rows="3"></textarea>
        </div>
      </div>

      <!-- Applicant Details -->
      <div class="tq-section-title">Applicant Details</div>
      <div class="tq-grid">
        <div class="tq-full">
          <label class="tq-label">Applicant Name</label>
          <input type="text" class="tq-input" id="tq-applicantName">
        </div>
        <div>
          <label class="tq-label">Country</label>
          <select class="tq-select" id="tq-applicantCountry">
            <option>Bangladesh</option>
          </select>
        </div>
        <div class="tq-full">
          <label class="tq-label">Address</label>
          <input type="text" class="tq-input" id="tq-applicantAddress">
        </div>
      </div>

      <!-- Beneficiary Details -->
      <div class="tq-section-title">Beneficiary Details</div>
      <div class="tq-grid">
        <div class="tq-full">
          <label class="tq-label">Beneficiary Name</label>
          <input type="text" class="tq-input" id="tq-beneficiaryName">
        </div>
        <div>
          <label class="tq-label">Country</label>
          <select class="tq-select" id="tq-beneficiaryCountry">
            <option>Germany</option>
          </select>
        </div>
        <div class="tq-full">
          <label class="tq-label">Beneficiary Bank</label>
          <input type="text" class="tq-input" id="tq-beneficiaryBank">
        </div>
      </div>

      <!-- Shipment Details -->
      <div class="tq-section-title">Shipment Details</div>
      <div class="tq-grid">
        <div>
          <label class="tq-label">Shipment Date</label>
          <input type="date" class="tq-input" id="tq-shipmentDate">
        </div>
        <div>
          <label class="tq-label">Port of Loading</label>
          <input type="text" class="tq-input" id="tq-portLoading">
        </div>
        <div>
          <label class="tq-label">Port of Unloading</label>
          <input type="text" class="tq-input" id="tq-portUnloading">
        </div>
      </div>

      <!-- Documents Upload -->
      <div class="tq-section-title">Upload Documents</div>
      <div class="tq-file-upload">
        <input type="file" id="tq-fileUpload" multiple accept=".pdf,.png,.jpg">
        <i class="fas fa-cloud-upload-alt" style="font-size:32px;color:var(--gold);margin-bottom:10px"></i>
        <p><strong>Click or drag files</strong></p>
        <p style="font-size:11px">PDF, PNG, JPG up to 10MB</p>
      </div>

      <button type="submit" class="tq-submit" onclick="handleFormSubmit(event, 'trade-quote')">
        <i class="fas fa-paper-plane"></i> Submit Quote Request
      </button>
    </form>
  </div>
</div>

<!-- MY APPLICATIONS -->
<div id="applications" class="page-content" style="display:none">
  <table class="datacard">
    <tr><td colspan="5" class="datacardtitle">My Applications</td></tr>
    <tr><td><strong>Type</strong></td><td><strong>Reference</strong></td><td><strong>Date</strong></td><td><strong>Status</strong></td><td><strong>Action</strong></td></tr>
    <tbody id="applicationsList">
      <tr><td colspan="5" style="text-align:center;padding:20px">No applications found</td></tr>
    </tbody>
  </table>
</div>

<!-- COMPANY INFO -->
<div id="company-info" class="page-content" style="display:none">
  <table class="datacard">
    <tr><td colspan="2" class="datacardtitle"><i class="fas fa-building"></i> Company Information</td></tr>
    <tr><td style="width:35%">Company Name:</td><td id="infoCompanyName">-</td></tr>
    <tr><td>User Type:</td><td id="infoUserType">-</td></tr>
    <tr><td>Contact Person:</td><td id="infoContactPerson">-</td></tr>
    <tr><td>Email:</td><td id="infoEmail">-</td></tr>
    <tr><td>Phone:</td><td id="infoPhone">-</td></tr>
    <tr><td>Address:</td><td id="infoAddress">-</td></tr>
    <tr><td>Trade License:</td><td id="infoTradeLicense">-</td></tr>
    <tr><td>TIN:</td><td id="infoTIN">-</td></tr>
    <tr><td colspan="2" style="text-align:center;padding:14px">
      <button class="btn btn-primary" data-page="settings"><i class="fas fa-edit"></i> Edit Profile</button>
    </td></tr>
  </table>
</div>

<!-- LC APPLICATION -->
<div id="lc-application" class="page-content" style="display:none">
  <table class="datacard">
    <tr><td colspan="2" class="datacardtitle"><i class="fas fa-file-invoice-dollar"></i> LC Application Form</td></tr>
    <tr><td>Applicant:</td><td><input type="text" id="lc-applicant" value="Global Trading Co." style="width:100%;padding:8px"></td></tr>
    <tr><td>LC Type:</td><td>
      <select id="lc-type" style="width:100%;padding:8px">
        <option>Sight LC</option>
        <option>Usance LC</option>
      </select>
    </td></tr>
    <tr><td>Currency / Amount:</td><td><input type="text" id="lc-amount" value="USD 500,000.00" style="width:100%;padding:8px"></td></tr>
    <tr><td>Beneficiary:</td><td><input type="text" id="lc-beneficiary" value="ABC Exports Ltd., Germany" style="width:100%;padding:8px"></td></tr>
    <tr><td>Issuing Bank:</td><td>
      <select id="lc-bank" style="width:100%;padding:8px">
        <option>BRAC Bank PLC, Dhaka</option>
      </select>
    </td></tr>
    <tr><td colspan="2" style="text-align:center;padding:14px">
      <button class="btn btn-primary" onclick="handleFormSubmit(event, 'lc-application')"><i class="fas fa-paper-plane"></i> Submit LC Application</button>
      <button class="btn btn-outline" data-page="swift-generator"><i class="fas fa-file-code"></i> Generate Swift</button>
    </td></tr>
  </table>
</div>

<!-- PROJECT FINANCE (from projectfinance.html) -->
<div id="project-finance" class="page-content" style="display:none">
  <div class="pf-container">
    <div class="pf-header">
      <h2>Project Finance Advisory</h2>
      <h3>Trade and Project Finance Advisory</h3>
    </div>

    <div class="pf-alert">
      <strong>Important:</strong> A $500 non-refundable validation fee is required upon submission. This fee covers the review of your application, the preparation of a preliminary term sheet, and access to our global network for distribution and trade credit opportunities. If we determine that we can't proceed with your deal, the fee will be fully refunded.
      <br><br>
      <em>Applications submitted without payment will not be processed. Once received, our team will assess your request and issue a term sheet within 3–7 business days.</em>
    </div>

    <form id="projectFinanceForm">
      <!-- Section 1: Applicant Information -->
      <div class="pf-section">
        <h4 class="pf-section-title">1. Applicant Details</h4>
        <div class="pf-row">
          <div class="pf-group">
            <label class="pf-label">Full Name <span class="tq-required">*</span></label>
            <input type="text" class="tq-input" id="pf-fullName" required>
          </div>
          <div class="pf-group">
            <label class="pf-label">Company Name <span class="tq-required">*</span></label>
            <input type="text" class="tq-input" id="pf-companyName" required>
          </div>
          <div class="pf-group">
            <label class="pf-label">Email Address <span class="tq-required">*</span></label>
            <input type="email" class="tq-input" id="pf-email" required>
          </div>
          <div class="pf-group">
            <label class="pf-label">Phone Number <span class="tq-required">*</span></label>
            <span class="pf-sub">(Please insert Country Code)</span>
            <input type="tel" class="tq-input" id="pf-phone" required placeholder="+880...">
          </div>
          <div class="pf-group full">
            <label class="pf-label">Country of Incorporation <span class="tq-required">*</span></label>
            <input type="text" class="tq-input" id="pf-country" required>
          </div>
          <div class="pf-group full">
            <label class="pf-label">Mailing Address <span class="tq-required">*</span></label>
            <span class="pf-sub">Please provide an address where we can send you physical mail if required during the transaction.</span>
            <textarea class="tq-textarea" id="pf-address" rows="3" required></textarea>
          </div>
        </div>
      </div>

      <!-- Section 2: Financial Request -->
      <div class="pf-section">
        <h4 class="pf-section-title">2. Financial Request</h4>
        <div class="pf-row">
          <div class="pf-group full">
            <label class="pf-label">Total financing amount required (US$) <span class="tq-required">*</span></label>
            <input type="number" class="tq-input" id="pf-amount" required>
          </div>
          <div class="pf-group full">
            <label class="pf-label">Funds allocation breakdown <span class="tq-required">*</span></label>
            <span class="pf-sub">(e.g., construction, equipment, working capital)</span>
            <textarea class="tq-textarea" id="pf-allocation" rows="3" required></textarea>
          </div>
          <div class="pf-group full">
            <label class="pf-label">Advisory budget <span class="tq-required">*</span></label>
            <span class="pf-sub">Underwriting and distribution usually require a budget between $50,000 and $500,000</span>
            <input type="text" class="tq-input" id="pf-budget" required placeholder="e.g. $75,000">
          </div>
        </div>
      </div>

      <!-- Section 3: Project Details -->
      <div class="pf-section">
        <h4 class="pf-section-title">3. Project Overview & Milestones</h4>
        
        <div class="pf-group full" style="margin-bottom:20px">
          <label class="pf-label">Project Stage <span class="tq-required">*</span></label>
          <div class="pf-checkbox-group">
            <label class="pf-checkbox-item"><input type="radio" name="projectStage" value="Concept/Planning" required> Concept/Planning</label>
            <label class="pf-checkbox-item"><input type="radio" name="projectStage" value="Pre-Construction"> Pre-Construction</label>
            <label class="pf-checkbox-item"><input type="radio" name="projectStage" value="Construction"> Construction</label>
            <label class="pf-checkbox-item"><input type="radio" name="projectStage" value="Operational"> Operational</label>
          </div>
        </div>

        <div class="pf-group full" style="margin-bottom:20px">
          <label class="pf-label">Milestones achieved <span class="tq-required">*</span></label>
          <div class="pf-checkbox-group">
            <label class="pf-checkbox-item"><input type="checkbox" name="milestones" value="Feasibility"> <span class="pf-checkbox-desc">Completion of feasibility studies or market research</span></label>
            <label class="pf-checkbox-item"><input type="checkbox" name="milestones" value="Funding"> <span class="pf-checkbox-desc">Securing initial funding or investment commitments</span></label>
            <label class="pf-checkbox-item"><input type="checkbox" name="milestones" value="Permits"> <span class="pf-checkbox-desc">Obtaining required permits, licenses, or regulatory approvals</span></label>
            <label class="pf-checkbox-item"><input type="checkbox" name="milestones" value="Infrastructure"> <span class="pf-checkbox-desc">Setting up infrastructure, technology, or supply chains</span></label>
          </div>
        </div>

        <div class="pf-group full">
          <label class="pf-label">Key stakeholders <span class="tq-required">*</span></label>
          <div class="pf-checkbox-group">
            <label class="pf-checkbox-item"><input type="checkbox" name="stakeholders" value="Sponsors"> <span class="pf-checkbox-desc"><strong>Sponsors</strong> – Those providing financial backing</span></label>
            <label class="pf-checkbox-item"><input type="checkbox" name="stakeholders" value="Developers"> <span class="pf-checkbox-desc"><strong>Developers</strong> – The team designing and planning the project</span></label>
            <label class="pf-checkbox-item"><input type="checkbox" name="stakeholders" value="Contractors"> <span class="pf-checkbox-desc"><strong>Contractors</strong> – Responsible for construction or service delivery</span></label>
            <label class="pf-checkbox-item"><input type="checkbox" name="stakeholders" value="Operators"> <span class="pf-checkbox-desc"><strong>Operators</strong> – The entity that will run the project once operational</span></label>
          </div>
        </div>
      </div>

      <!-- Section 4: Revenue & Security -->
      <div class="pf-section">
        <h4 class="pf-section-title">4. Revenue Model & Security</h4>
        
        <div class="pf-group full" style="margin-bottom:20px">
          <label class="pf-label">Primary revenue model <span class="tq-required">*</span></label>
          <div class="pf-checkbox-group">
            <label class="pf-checkbox-item"><input type="checkbox" name="revenueModel" value="Direct Sales"> Direct Sales</label>
            <label class="pf-checkbox-item"><input type="checkbox" name="revenueModel" value="Subscription"> Subscription/Membership</label>
            <label class="pf-checkbox-item"><input type="checkbox" name="revenueModel" value="Service Fees"> Service Fees</label>
            <label class="pf-checkbox-item"><input type="checkbox" name="revenueModel" value="Licensing"> Licensing/Royalty</label>
          </div>
        </div>

        <div class="pf-group full" style="margin-bottom:20px">
          <label class="pf-label">Supporting contracts <span class="tq-required">*</span></label>
          <div class="pf-checkbox-group">
            <label class="pf-checkbox-item"><input type="checkbox" name="contracts" value="Offtake"> Offtake Agreements</label>
            <label class="pf-checkbox-item"><input type="checkbox" name="contracts" value="PPA"> Power Purchase Agreements (PPAs)</label>
            <label class="pf-checkbox-item"><input type="checkbox" name="contracts" value="Service"> Service Contracts</label>
          </div>
        </div>
      </div>

      <!-- Section 5: Key Dates -->
      <div class="pf-section">
        <h4 class="pf-section-title">5. Key Dates</h4>
        <div class="pf-dates">
          <div>
            <span class="pf-sub">Financing Target Date</span>
            <input type="date" class="tq-input" id="pf-dateFinancing" required>
          </div>
          <div>
            <span class="pf-sub">Construction Start Date</span>
            <input type="date" class="tq-input" id="pf-dateConstruction" required>
          </div>
          <div>
            <span class="pf-sub">Operation Launch Date</span>
            <input type="date" class="tq-input" id="pf-dateOperation" required>
          </div>
        </div>
      </div>

      <!-- Terms and Conditions -->
      <div class="pf-section" style="border-bottom:none">
        <h4 class="pf-section-title">Terms and Conditions <span class="tq-required">*</span></h4>
        
        <div class="pf-terms">
          By submitting this form and engaging TFSBD, you agree to the following: TFSBD provides project finance advisory services, including evaluating financial feasibility, structuring proposals, and engaging potential funding sources. A $500 non-refundable application fee covers the initial evaluation. If your project qualifies, a minimum mandate fee of $50,000 USD will apply, adjusted based on scope and complexity. Clients must provide accurate and complete project information promptly. TFSBD does not guarantee funding, as all financing decisions depend on third-party evaluations and approvals. Out-of-pocket expenses like travel, due diligence, and legal reviews are billed separately. TFSBD maintains strict confidentiality but is not liable for third-party breaches or funding failures. Services can be terminated by either party, with fees paid up to termination being non-refundable. These terms are governed by Swiss law, under the jurisdiction of the Canton of Bangladesh. Submission of this form and payment of the $500 fee confirms your agreement to these terms.
        </div>

        <div class="pf-group">
          <label class="pf-checkbox-item">
            <input type="checkbox" name="acceptTerms" required>
            <strong>I accept the Terms and Conditions.</strong>
          </label>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="pf-buttons">
        <button type="button" class="pf-btn-view" onclick="window.print()">View / Print</button>
        <button type="submit" class="pf-btn-submit" onclick="handleFormSubmit(event, 'project-finance')">Proceed to $500 Payment & Submit</button>
      </div>
    </form>
  </div>
</div>

<!-- HELP -->
<div id="help" class="page-content" style="display:none">
  <table class="datacard">
    <tr><td colspan="2" class="datacardtitle">Help &amp; Support</td></tr>
    <tr><td>Email:</td><td>info@tfsbd.com</td></tr>
    <tr><td>Phone:</td><td>+880 1700 000000</td></tr>
    <tr><td>Hours:</td><td>Mon–Fri, 9AM–5PM BST</td></tr>
    <tr><td colspan="2" style="padding:14px;text-align:center">
      <button class="btn btn-primary"><i class="fas fa-download"></i> Download User Guide</button>
    </td></tr>
  </table>
</div>

<!-- SETTINGS (Registration Form) -->
<div id="settings" class="page-content" style="display:none">
  <div class="reg-form">
    <h3><i class="fas fa-user-plus"></i> Company Registration</h3>
    
    <form id="registrationForm">
      <!-- User Type Selection -->
      <div class="form-group">
        <label>User Type <span class="required">*</span></label>
        <select id="reg-userType" required>
          <option value="">-- Select User Type --</option>
          <option value="agent">Agent</option>
          <option value="owner">Owner / Principal</option>
        </select>
      </div>

      <!-- Company Logo Upload -->
      <div class="form-group">
        <label>Company Logo</label>
        <div class="logo-upload">
          <input type="file" id="reg-logo" accept="image/*" onchange="previewLogo(this)">
          <i class="fas fa-cloud-upload-alt" style="font-size:24px;color:var(--gold);margin-bottom:8px"></i>
          <p><strong>Click to upload logo</strong></p>
          <p style="font-size:11px">PNG, JPG (Max 2MB)</p>
        </div>
        <div class="logo-preview" id="logoPreview">
          <img src="" alt="Logo preview">
        </div>
      </div>

      <!-- Personal Information -->
      <div class="form-group">
        <label>Full Name <span class="required">*</span></label>
        <input type="text" id="reg-fullName" required placeholder="John Doe">
      </div>

      <!-- Company Information -->
      <div class="form-group">
        <label>Company Name <span class="required">*</span></label>
        <input type="text" id="reg-companyName" required placeholder="Global Trading Co.">
      </div>

      <div class="form-group">
        <label>Email Address <span class="required">*</span></label>
        <input type="email" id="reg-email" required placeholder="contact@company.com">
      </div>

      <div class="form-group">
        <label>Phone Number <span class="required">*</span></label>
        <input type="tel" id="reg-phone" required placeholder="+880 1712 345678">
      </div>

      <div class="form-group">
        <label>Address <span class="required">*</span></label>
        <input type="text" id="reg-address" required placeholder="123 Business Street, Dhaka">
      </div>

      <div class="form-group">
        <label>Trade License Number</label>
        <input type="text" id="reg-tradeLicense" placeholder="TL-2024-001234">
      </div>

      <div class="form-group">
        <label>TIN / BIN Number</label>
        <input type="text" id="reg-tin" placeholder="123-456-789">
      </div>

      <!-- Password for future login -->
      <div class="form-group">
        <label>Password <span class="required">*</span></label>
        <input type="password" id="reg-password" required placeholder="********">
        <small style="color:var(--muted);font-size:10px">Min. 8 characters</small>
      </div>

      <button type="submit" class="btn btn-primary" style="width:100%;padding:12px" onclick="handleRegistration(event)">
        <i class="fas fa-save"></i> Save & Complete Registration
      </button>
    </form>
  </div>
</div>

<!-- ════════════════════════════════════════════════
     SWIFT MESSAGE GENERATOR (Full Version)
     ════════════════════════════════════════════════ -->
<div id="swift-generator" class="page-content" style="display:none">

  <div class="sg-header">
    <div class="sg-header-inner">
      <div class="sg-icon">📄</div>
      <div>
        <h2>Swift Message Generator – Draft Copy</h2>
        <p>Generate, preview and send SWIFT MT700-series documentary credit messages · SWIFT SR2018 compliant</p>
      </div>
    </div>
  </div>

  <!-- ── STEP 0: INVOICE UPLOAD ── -->
  <div class="sg-section">
    <div class="sg-section-title"><span class="step-tag">STEP 0</span> Upload Invoice / Proforma Invoice <span style="font-size:11px;color:var(--muted);font-weight:400;font-family:'IBM Plex Sans',sans-serif">(Optional – Auto-fills key fields)</span></div>
    <div class="sg-grid2">
      <div>
        <div class="upload-box" id="upload-box">
          <input type="file" id="invoice-upload" accept=".pdf,.jpg,.jpeg,.png,.xlsx,.xls,.docx" onchange="onInvoiceUpload(this)"/>
          <div class="ub-icon">📎</div>
          <strong>Click or drag &amp; drop your Invoice / Proforma Invoice</strong>
          <p>Accepted formats: PDF, JPG, PNG, Excel, Word</p>
        </div>
        <div class="upload-status" id="upload-status"></div>
      </div>
      <div style="background:var(--cream);border-radius:8px;padding:14px;border:1px solid var(--border);font-size:12px;color:var(--muted)">
        <strong style="color:var(--navy);display:block;margin-bottom:8px">ℹ️ Auto-Generate on Upload</strong>
        Once an invoice or proforma invoice is uploaded, the following fields will be <strong style="color:var(--green)">auto-populated</strong>:
        <ul style="margin:8px 0 0 14px;line-height:1.9">
          <li>:50: Applicant name &amp; address</li>
          <li>:59: Beneficiary name &amp; address</li>
          <li>:45A: Description of goods / services</li>
          <li>:32B: Currency &amp; amount</li>
          <li>:42P: Deferred payment details</li>
          <li>:44A: Place of receipt / dispatch</li>
        </ul>
        <p style="margin-top:8px;font-size:10px;color:#999">Fields remain editable after auto-fill. You can always override them manually.</p>
      </div>
    </div>
  </div>

  <!-- ── STEP 1: MESSAGE TYPE ── -->
  <div class="sg-section">
    <div class="sg-section-title"><span class="step-tag">STEP 1</span> Message Type Selection</div>
    <div class="sg-grid2">
      <div class="field-group" id="fg-msgtype">
        <label class="field-label"><span class="badge-m">M</span> Message Type</label>
        <select id="sel-msgtype" onchange="onMsgTypeChange()">
          <option value="" disabled selected>-- Select Message Type --</option>
          <option value="MT700">MT700 – Issue of a Documentary Credit</option>
          <option value="MT701">MT701 – Issue of a Documentary Credit (Continuation)</option>
          <option value="MT707">MT707 – Amendment to a Documentary Credit</option>
          <option value="MT710">MT710 – Advice of a Third Bank's Documentary Credit</option>
          <option value="MT709">MT709 – Free Format Message</option>
        </select>
        <div class="error-msg">Please select a message type.</div>
      </div>
      <div class="field-group">
        <label class="field-label">Date of Generation</label>
        <input type="date" id="gen-date"/>
      </div>
    </div>
  </div>

  <!-- ── STEP 2: SENDER ── -->
  <div class="sg-section">
    <div class="sg-section-title"><span class="step-tag">STEP 2</span> Sender (Issuing Bank)</div>
    <div class="sg-grid2">
      <div class="field-group" id="fg-sender">
        <label class="field-label"><span class="badge-m">M</span> Sender Bank – Bangladesh Bank</label>
        <div class="input-combo">
          <div class="input-combo-row">
            <select id="sel-sender" onchange="onSenderChange()">
              <option value="" disabled selected>-- Select Bangladesh Bank --</option>
            </select>
            <button class="toggle-manual" onclick="toggleSenderManual()">Abroad Bank ✏️</button>
          </div>
          <input type="text" id="sender-manual" class="manual-input" placeholder="Type sender bank name (abroad bank)" oninput="onSenderManualInput()"/>
        </div>
        <div class="swift-preview" id="sender-swift-preview"></div>
        <div class="error-msg">Please select or enter the sender bank.</div>
      </div>
      <div class="field-group">
        <label class="field-label">⚡ BIC: Sender SWIFT Code <span class="auto-tag">Auto-Generate</span></label>
        <input type="text" id="sender-swift" placeholder="Auto-generated from bank selection" readonly style="font-family:'IBM Plex Mono',monospace;font-size:12px"/>
        <div class="field-help">Auto-fills when a Bangladesh bank is selected. Type manually for abroad banks.</div>
      </div>
    </div>
    <!-- Abroad bank manual BIC override -->
    <div id="sender-bic-manual-row" style="display:none;margin-top:10px">
      <div class="field-group">
        <label class="field-label">Sender SWIFT Code / BIC (Abroad Bank)</label>
        <input type="text" id="sender-swift-manual" placeholder="e.g. DEUTDEDB" maxlength="11" style="font-family:'IBM Plex Mono',monospace;font-size:12px;max-width:300px" oninput="document.getElementById('sender-swift').value=this.value.toUpperCase()"/>
      </div>
    </div>
  </div>

  <!-- ── STEP 3: RECEIVER ── -->
  <div class="sg-section">
    <div class="sg-section-title"><span class="step-tag">STEP 3</span> Receiver Bank</div>
    <div class="sg-grid3">
      <div class="field-group" id="fg-recv-name">
        <label class="field-label"><span class="badge-m">M</span> Receiver Bank Name</label>
        <input type="text" id="recv-name" placeholder="e.g. Standard Chartered Bank"/>
        <div class="error-msg">Required field.</div>
      </div>
      <div class="field-group" id="fg-recv-swift">
        <label class="field-label"><span class="badge-m">M</span> Receiver SWIFT Code (BIC)</label>
        <input type="text" id="recv-swift" placeholder="e.g. SCBLBDDX" maxlength="11" style="font-family:'IBM Plex Mono',monospace;font-size:12px"/>
        <div class="error-msg">Required field.</div>
      </div>
      <div class="field-group">
        <label class="field-label">Receiver Address / Place</label>
        <input type="text" id="recv-addr" placeholder="e.g. Dhaka, Bangladesh"/>
      </div>
    </div>
  </div>

  <!-- ── STEP 4: LC FIELDS (always visible for MT700) ── -->
  <div class="sg-section" id="lc-fields" style="display:block">
    <div class="sg-section-title">
      <span class="step-tag" id="lc-section-tag">STEP 4</span>
      <span id="lc-section-name">LC Fields</span>
    </div>

    <!-- 27 / 40A / 20 / 40E -->
    <div class="category-label">Basic Details</div>
    <div class="sg-grid2" style="row-gap:14px">
      <div class="field-group" id="fg-f27">
        <label class="field-label"><span class="badge-m">M</span> :27: Sequence of Total</label>
        <input type="text" id="f-27" placeholder="1/1" value="1/1"/>
      </div>
      <div class="field-group" id="fg-f40A">
        <label class="field-label"><span class="badge-m">M</span> :40A: Form of Documentary Credit</label>
        <select id="f-40A">
          <option value="" disabled selected>-- Select --</option>
          <option>IRREVOCABLE</option>
          <option>IRREVOCABLE TRANSFERABLE</option>
          <option>IRREVOCABLE STANDBY</option>
          <option>IRREVOC TRANS STANDBY</option>
        </select>
        <div class="error-msg">Required.</div>
      </div>
      <div class="field-group" id="fg-f20">
        <label class="field-label"><span class="badge-m">M</span> :20: Documentary Credit Number</label>
        <input type="text" id="f-20" placeholder="e.g. LC/2024/001234"/>
        <div class="error-msg">Required.</div>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :23: Reference to Pre-Advice</label>
        <input type="text" id="f-23" placeholder="e.g. PREADV/2024/001"/>
      </div>
      <div class="field-group" id="fg-f31C">
        <label class="field-label"><span class="badge-m">M</span> :31C: Date of Issue</label>
        <input type="date" id="f-31C"/>
        <div class="error-msg">Required.</div>
      </div>
      <div class="field-group" id="fg-f40E">
        <label class="field-label"><span class="badge-m">M</span> :40E: Applicable Rules</label>
        <select id="f-40E">
          <option value="" disabled selected>-- Select --</option>
          <option>UCP LATEST VERSION</option>
          <option>UCPURR LATEST VERSION</option>
          <option>ISP LATEST VERSION</option>
          <option>EUCP LATEST VERSION</option>
          <option>EUCPURR LATEST VERSION</option>
          <option>OTHR</option>
        </select>
        <div class="error-msg">Required.</div>
      </div>
      <div class="field-group sg-full" id="fg-f31D">
        <label class="field-label"><span class="badge-m">M</span> :31D: Date and Place of Expiry</label>
        <input type="text" id="f-31D" placeholder="e.g. 231231 DHAKA"/>
        <div class="field-help">ℹ️ Format: YYMMDD followed by place.</div>
        <div class="error-msg">Required.</div>
      </div>
    </div>

    <!-- Applicant Bank -->
    <div class="category-label" style="margin-top:18px">Applicant Bank (51A)</div>
    <div class="sg-grid2" style="row-gap:14px">
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :51A: Applicant Bank</label>
        <select id="f-51A" onchange="onApplicantBankChange()">
          <option value="" selected>-- Select Bangladesh Bank (optional) --</option>
        </select>
        <div class="swift-preview" id="appbank-preview"></div>
      </div>
      <div class="field-group">
        <label class="field-label">:42A: Drawee <span class="auto-tag">Auto from 51A</span></label>
        <input type="text" id="f-42A" placeholder="Auto-generated from Applicant Bank (51A)" readonly style="font-family:'IBM Plex Mono',monospace;font-size:12px"/>
        <div class="field-help">ℹ️ Auto-fills BIC from selected Applicant Bank.</div>
      </div>
    </div>

    <!-- :50: Applicant / :59: Beneficiary -->
    <div class="category-label" style="margin-top:18px">Applicant &amp; Beneficiary</div>
    <div class="sg-grid2" style="row-gap:14px">
      <div class="field-group sg-full" id="fg-f50">
        <label class="field-label"><span class="badge-m">M</span> :50: Applicant <span class="auto-tag">Auto from Invoice</span></label>
        <textarea id="f-50" rows="3" placeholder="Full name and address of the applicant (buyer/importer)&#10;Auto-populated from uploaded invoice"></textarea>
        <div class="autofill-note" id="autofill-50">✅ Auto-filled from uploaded invoice — editable</div>
        <div class="error-msg">Required.</div>
      </div>
      <div class="field-group sg-full" id="fg-f59">
        <label class="field-label"><span class="badge-m">M</span> :59: Beneficiary <span class="auto-tag">Auto from Invoice</span></label>
        <textarea id="f-59" rows="3" placeholder="Full name and address of the beneficiary (seller/exporter)&#10;Auto-populated from uploaded invoice"></textarea>
        <div class="autofill-note" id="autofill-59">✅ Auto-filled from uploaded invoice — editable</div>
        <div class="error-msg">Required.</div>
      </div>
    </div>

    <!-- :32B: Currency / Amount -->
    <div class="category-label" style="margin-top:18px">Amount &amp; Availability</div>
    <div class="sg-grid2" style="row-gap:14px">
      <div class="field-group" id="fg-f32B">
        <label class="field-label"><span class="badge-m">M</span> :32B: Currency Code, Amount</label>
        <div class="inline-row">
          <select id="f-32B-ccy" style="flex:0 0 130px">
            <option value="" disabled selected>Currency</option>
          </select>
          <input type="text" id="f-32B-amt" placeholder="e.g. 50000,00" style="flex:1"/>
        </div>
        <div class="field-help">ℹ️ Use comma as decimal separator (SWIFT format).</div>
        <div class="error-msg" id="err-32B">Required.</div>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :39A: Percentage Credit Amount Tolerance</label>
        <input type="text" id="f-39A" placeholder="e.g. 05/05"/>
        <div class="field-help">ℹ️ Format: NN/NN (above/below)</div>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-m">M</span> :41A: Available With ... By ...</label>
        <input type="text" id="f-41A" placeholder="e.g. ANY BANK BY NEGOTIATION"/>
        <div class="error-msg">Required.</div>
      </div>
      <div class="field-group" id="fg-f49">
        <label class="field-label"><span class="badge-m">M</span> :49: Confirmation Instructions</label>
        <select id="f-49">
          <option value="" disabled selected>-- Select --</option>
          <option>CONFIRM</option>
          <option>MAY ADD</option>
          <option>WITHOUT</option>
        </select>
        <div class="error-msg">Required.</div>
      </div>
    </div>

    <!-- Drafts / Payment -->
    <div class="category-label" style="margin-top:18px">Drafts &amp; Payment</div>
    <div class="sg-grid2" style="row-gap:14px">
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :42C: Drafts at ...</label>
        <select id="f-42C">
          <option value="" disabled selected>-- Select Tenor --</option>
          <option value="SIGHT">SIGHT – Beneficiary gets payment at sight</option>
          <option value="90 DAYS">90 DAYS – Beneficiary gets payment at sight</option>
          <option value="180 DAYS">180 DAYS – Beneficiary gets payment at sight</option>
          <option value="360 DAYS">360 DAYS – Beneficiary gets payment at sight</option>
        </select>
        <div class="field-help">ℹ️ Regardless of tenor, beneficiary gets payment at sight.</div>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :42P: Negotiation/Deferred Payment Details <span class="auto-tag">Auto from Invoice</span></label>
        <textarea id="f-42P" rows="2" placeholder="Auto-generated from uploaded invoice; or specify deferred payment details"></textarea>
        <div class="autofill-note" id="autofill-42P">✅ Auto-filled from uploaded invoice — editable</div>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :39C: Additional Amounts Covered</label>
        <textarea id="f-39C" rows="2" placeholder="e.g. Insurance, freight charges"></textarea>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :42M: Mixed Payment Details</label>
        <textarea id="f-42M" rows="2" placeholder="Specify mixed payment dates/amounts"></textarea>
      </div>
    </div>

    <!-- Shipment Fields -->
    <div class="category-label" style="margin-top:18px">Shipment Details</div>
    <div class="sg-grid2" style="row-gap:14px">
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :43P: Partial Shipments</label>
        <select id="f-43P">
          <option value="" disabled selected>-- Select --</option>
          <option>Allowed</option><option>Not Allowed</option><option>Conditional</option>
        </select>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :43T: Transshipment</label>
        <select id="f-43T">
          <option value="" disabled selected>-- Select --</option>
          <option>Allowed</option><option>Not Allowed</option><option>Conditional</option>
        </select>
      </div>

      <!-- :44A: Place of Receipt — BD Ports + manual -->
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :44A: Place of Taking in Charge / Place of Receipt <span class="auto-tag">Auto from Invoice</span></label>
        <div class="input-combo">
          <div class="input-combo-row">
            <select id="f-44A-sel" onchange="syncPortField('f-44A-sel','f-44A')">
              <option value="" disabled selected>-- Bangladesh Port --</option>
            </select>
            <button class="toggle-manual" onclick="togglePortManual('44A')">Abroad ✏️</button>
          </div>
          <input type="text" id="f-44A" class="manual-input" placeholder="Type place/port for abroad customer"/>
        </div>
        <div class="autofill-note" id="autofill-44A">✅ Auto-filled from uploaded invoice — editable</div>
      </div>

      <!-- :44B: Place of Final Destination — BD Ports + manual -->
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :44B: Place of Final Destination / Place of Delivery</label>
        <div class="input-combo">
          <div class="input-combo-row">
            <select id="f-44B-sel" onchange="syncPortField('f-44B-sel','f-44B')">
              <option value="" disabled selected>-- Bangladesh Port --</option>
            </select>
            <button class="toggle-manual" onclick="togglePortManual('44B')">Abroad ✏️</button>
          </div>
          <input type="text" id="f-44B" class="manual-input" placeholder="Type place/port for abroad customer"/>
        </div>
      </div>

      <!-- :44E: Port of Loading — International -->
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :44E: Port of Loading / Airport of Departure</label>
        <div class="input-combo">
          <div class="input-combo-row">
            <select id="f-44E-sel" onchange="syncPortField('f-44E-sel','f-44E')">
              <option value="" disabled selected>-- Major International Port --</option>
            </select>
            <button class="toggle-manual" onclick="togglePortManual('44E')">Type ✏️</button>
          </div>
          <input type="text" id="f-44E" class="manual-input" placeholder="Type port/airport name"/>
        </div>
      </div>

      <!-- :44F: Port of Discharge — International -->
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :44F: Port of Discharge / Airport of Destination</label>
        <div class="input-combo">
          <div class="input-combo-row">
            <select id="f-44F-sel" onchange="syncPortField('f-44F-sel','f-44F')">
              <option value="" disabled selected>-- Major International Port --</option>
            </select>
            <button class="toggle-manual" onclick="togglePortManual('44F')">Type ✏️</button>
          </div>
          <input type="text" id="f-44F" class="manual-input" placeholder="Type port/airport name"/>
        </div>
      </div>

      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :44C: Latest Date of Shipment</label>
        <input type="date" id="f-44C"/>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :44D: Shipment Period</label>
        <textarea id="f-44D" rows="2" placeholder="e.g. WITHIN 30 DAYS OF LC ISSUANCE"></textarea>
      </div>
    </div>

    <!-- :45A: Description of Goods -->
    <div class="category-label" style="margin-top:18px">Description of Goods</div>
    <div class="field-group">
      <label class="field-label"><span class="badge-o">O</span> :45A: Description of Goods and/or Services <span class="auto-tag">Auto from Invoice</span></label>
      <textarea id="f-45A" rows="4" placeholder="Auto-generated from uploaded invoice; or describe goods/services in detail (HS code, quantity, unit price)"></textarea>
      <div class="autofill-note" id="autofill-45A">✅ Auto-filled from uploaded invoice — editable</div>
    </div>

    <!-- :46A: DOCUMENTS REQUIRED (Structured) -->
    <div class="category-label" style="margin-top:18px">Documents Required (:46A:)</div>
    <p style="font-size:11px;color:var(--muted);margin-bottom:12px;font-style:italic">Fill in the blanks for each document clause. Leave blank to exclude.</p>

    <!-- (A) Commercial Invoice -->
    <div class="doc-item">
      <div class="doc-item-header"><span class="doc-letter">A</span> Beneficiary's Signed Commercial Invoices</div>
      <div class="doc-grid">
        <div class="field-group">
          <label class="field-label">Country of Origin</label>
          <select id="d46A-country"><option value="" disabled selected>-- Select Country --</option></select>
        </div>
        <div class="field-group">
          <label class="field-label">LC Number</label>
          <input type="text" id="d46A-lcno" placeholder="LC Number"/>
        </div>
        <div class="field-group">
          <label class="field-label">Invoice Date</label>
          <input type="date" id="d46A-date"/>
        </div>
      </div>
    </div>

    <!-- (B) Bill of Lading -->
    <div class="doc-item">
      <div class="doc-item-header"><span class="doc-letter">B</span> Full Set of Packaging List &amp; Bill of Lading</div>
      <div class="doc-grid">
        <div class="field-group">
          <label class="field-label">Endorsed to Order of Bank / Branch</label>
          <select id="d46B-bank"><option value="" disabled selected>-- Select Bank --</option></select>
        </div>
        <div class="field-group">
          <label class="field-label">Notify Bank / Branch</label>
          <select id="d46B-notify"><option value="" disabled selected>-- Notify Bank Branch --</option></select>
        </div>
      </div>
    </div>

    <!-- (C) Insurance -->
    <div class="doc-item">
      <div class="doc-item-header"><span class="doc-letter">C</span> Insurance (Covered by Applicant)</div>
      <div class="doc-grid">
        <div class="field-group">
          <label class="field-label">Insurance Company Email</label>
          <input type="email" id="d46C-email" placeholder="insurance@company.com"/>
        </div>
        <div class="field-group">
          <label class="field-label">Cover Note No.</label>
          <input type="text" id="d46C-coverno" placeholder="Cover Note Number"/>
        </div>
        <div class="field-group">
          <label class="field-label">Cover Note Date</label>
          <input type="date" id="d46C-date"/>
        </div>
      </div>
    </div>

    <!-- (F) Beneficiary's Certificate -->
    <div class="doc-item">
      <div class="doc-item-header"><span class="doc-letter">F</span> Beneficiary's Certificate (TIN / BIN)</div>
      <div class="doc-grid">
        <div class="field-group">
          <label class="field-label">Applicant TIN</label>
          <input type="text" id="d46F-tin" placeholder="TIN Number"/>
        </div>
        <div class="field-group">
          <label class="field-label">Applicant BIN</label>
          <input type="text" id="d46F-bin" placeholder="BIN Number"/>
        </div>
      </div>
    </div>

    <!-- (G) Non-Negotiable Shipping Docs -->
    <div class="doc-item">
      <div class="doc-item-header"><span class="doc-letter">G</span> Non-Negotiable Shipping Documents</div>
      <div class="doc-grid">
        <div class="field-group">
          <label class="field-label">Applicant Email</label>
          <input type="email" id="d46G-appl-email" placeholder="applicant@company.com"/>
        </div>
        <div class="field-group">
          <label class="field-label">Bank Email (CC)</label>
          <input type="email" id="d46G-bank-email" placeholder="bank@example.com"/>
        </div>
      </div>
    </div>

    <!-- :47A: ADDITIONAL CONDITIONS (Structured) -->
    <div class="category-label" style="margin-top:18px">Additional Conditions (:47A:)</div>

    <div class="cond-item">
      <div class="cond-item-num">(1) Shipment Date</div>
      <div class="field-group">
        <label class="field-label">Credit Issuing Date (Shipment must not be made before)</label>
        <input type="date" id="c47-1-date"/>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(2) LC Number &amp; Date on Documents</div>
      <div class="doc-grid">
        <div class="field-group">
          <label class="field-label">LC Number</label>
          <input type="text" id="c47-2-lcno" placeholder="LC Number"/>
        </div>
        <div class="field-group">
          <label class="field-label">LC Date</label>
          <input type="date" id="c47-2-date"/>
        </div>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(3) Applicant TIN &amp; BIN on Documents</div>
      <div class="doc-grid">
        <div class="field-group">
          <label class="field-label">TIN</label>
          <input type="text" id="c47-3-tin" placeholder="TIN Number"/>
        </div>
        <div class="field-group">
          <label class="field-label">BIN</label>
          <input type="text" id="c47-3-bin" placeholder="BIN Number"/>
        </div>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(4) Discrepancy Charges</div>
      <div class="field-group">
        <label class="field-label">Discrepancy Charge Amount (USD)</label>
        <input type="number" id="c47-4-amt" placeholder="100.00" value="100.00" step="0.01"/>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(5) Invoice Certification (Invoice No.)</div>
      <div class="field-group">
        <label class="field-label">Invoice Number</label>
        <input type="text" id="c47-5-invno" placeholder="Invoice Number"/>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(7) Language of Documents</div>
      <div class="field-group">
        <label class="field-label">Language of Credit</label>
        <select id="c47-7-lang">
          <option value="" disabled selected>-- Select Language --</option>
          <option>ENGLISH</option><option>ARABIC</option><option>FRENCH</option>
          <option>GERMAN</option><option>CHINESE</option><option>JAPANESE</option>
          <option>SPANISH</option><option>PORTUGUESE</option>
        </select>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(8) Invoice – FOB Value &amp; Freight Charge</div>
      <div class="doc-grid">
        <div class="field-group">
          <label class="field-label">FOB Value</label>
          <input type="text" id="c47-8-fob" placeholder="e.g. USD 45000,00"/>
        </div>
        <div class="field-group">
          <label class="field-label">Freight Charge</label>
          <input type="text" id="c47-8-freight" placeholder="e.g. USD 5000,00"/>
        </div>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(9) Packing</div>
      <div class="field-group">
        <label class="field-label">Packing Standard</label>
        <select id="c47-9-pack">
          <option value="" disabled selected>-- Select Packing --</option>
          <option>Export Standard Sea-Worthy Packing</option>
          <option>Export Standard Air-Worthy Packing</option>
          <option>Standard Commercial Packing</option>
          <option>Manufacturer's Standard Packing</option>
          <option>Bulk Packing</option>
        </select>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(11) Payment Processing Charge (USD)</div>
      <div class="field-group">
        <label class="field-label">Payment Processing Charge Amount (USD)</label>
        <input type="number" id="c47-11-amt" placeholder="100.00" value="100.00" step="0.01"/>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(12) Applicable Laws &amp; Compliance</div>
      <div class="field-group">
        <label class="field-label">Applicable Law(s)</label>
        <select id="c47-12-law" multiple style="height:90px">
          <option>Anti-boycott</option>
          <option>Anti-money laundering</option>
          <option>Anti-terrorism</option>
          <option>Anti-drug trafficking</option>
          <option>Economic sanctions laws</option>
        </select>
        <div class="field-help">ℹ️ Hold Ctrl/Cmd to select multiple laws.</div>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(13) Prohibited Country / Flag Vessels</div>
      <div class="field-group">
        <label class="field-label">Prohibited Country</label>
        <select id="c47-13-country"><option value="" disabled selected>-- Select Country --</option></select>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(14) Credit Amount Not Exceeding</div>
      <div class="field-group">
        <label class="field-label">Credit Amount Ceiling</label>
        <input type="text" id="c47-14-amt" placeholder="e.g. USD 50000,00"/>
      </div>
    </div>

    <div class="cond-item">
      <div class="cond-item-num">(15) Tenor / Sight Payment Arrangement</div>
      <div class="field-group">
        <label class="field-label">Tenor (days from LC issuance)</label>
        <input type="number" id="c47-15-tenor" placeholder="360" value="360"/>
      </div>
    </div>

    <!-- Remaining fields -->
    <div class="category-label" style="margin-top:18px">Charges &amp; Instructions</div>
    <div class="sg-grid2" style="row-gap:14px">
      <div class="field-group sg-full">
        <label class="field-label"><span class="badge-o">O</span> :71D: Charges</label>
        <textarea id="f-71D" rows="3" placeholder="e.g. ALL CHARGES OUTSIDE BANGLADESH ARE ON BENEFICIARY'S ACCOUNT INCLUDING LC ADVISING AND REIMBURSEMENT CHARGES BUT CONFIRMATION AND DISCOUNTING CHARGES ARE ON APPLICANT'S ACCOUNT.">ALL CHARGES OUTSIDE BANGLADESH ARE ON BENEFICIARY'S ACCOUNT INCLUDING LC ADVISING AND REIMBURSEMENT CHARGES BUT CONFIRMATION AND DISCOUNTING CHARGES ARE ON APPLICANT'S ACCOUNT.</textarea>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :48: Period for Presentation in Days</label>
        <input type="text" id="f-48" placeholder="e.g. 21"/>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :58a: Requested Confirmation Party</label>
        <input type="text" id="f-58a" placeholder="BIC of confirming bank" style="font-family:'IBM Plex Mono',monospace;font-size:12px"/>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :53a: Reimbursing Bank</label>
        <input type="text" id="f-53a" placeholder="BIC or name of reimbursing bank" style="font-family:'IBM Plex Mono',monospace;font-size:12px"/>
      </div>
      <div class="field-group">
        <label class="field-label"><span class="badge-o">O</span> :57A: Advise Through Bank</label>
        <input type="text" id="f-57A" placeholder="BIC of advising-through bank" style="font-family:'IBM Plex Mono',monospace;font-size:12px"/>
      </div>
    </div>

    <!-- :78: Instructions to Bank (Structured) -->
    <div class="category-label" style="margin-top:18px">:78: Instructions to Paying/Accepting/Negotiating Bank</div>
    <div class="doc-item">
      <div class="doc-item-header"><span class="doc-letter">I</span> Reimbursement Draw</div>
      <div class="doc-grid">
        <div class="field-group"><label class="field-label">U.S. Dollar A/C No.</label><input type="text" id="w78-1-acno" placeholder="Account Number"/></div>
        <div class="field-group"><label class="field-label">Bank Name</label><select id="w78-1-bank"><option value="" disabled selected>-- Select Bank --</option></select></div>
        <div class="field-group"><label class="field-label">BIC Code</label><input type="text" id="w78-1-bic" placeholder="BIC Code" style="font-family:'IBM Plex Mono',monospace;font-size:12px"/></div>
        <div class="field-group"><label class="field-label">Maturity Date</label><input type="date" id="w78-1-maturity"/></div>
        <div class="field-group"><label class="field-label">Working Days Prior Notice</label><input type="text" id="w78-1-days" placeholder="e.g. 3 working days"/></div>
      </div>
    </div>
    <div class="doc-item">
      <div class="doc-item-header"><span class="doc-letter">II</span> Negotiation Endorsement</div>
      <div class="field-group"><label class="field-label">Negotiation Reference</label><input type="text" id="w78-2-ref" placeholder="Negotiation Reference"/></div>
    </div>
    <div class="doc-item">
      <div class="doc-item-header"><span class="doc-letter">III</span> Document Routing</div>
      <div class="doc-grid">
        <div class="field-group"><label class="field-label">Send Through (Confirming Bank)</label><select id="w78-3-via"><option value="" disabled selected>-- Select Bank --</option></select></div>
        <div class="field-group"><label class="field-label">Destination Bank &amp; Branch</label><select id="w78-3-dest"><option value="" disabled selected>-- Select Bank &amp; Branch --</option></select></div>
        <div class="field-group"><label class="field-label">Contact Numbers</label><input type="text" id="w78-3-tel" placeholder="Tel: +880..."/></div>
        <div class="field-group"><label class="field-label">SWIFT BIC</label><input type="text" id="w78-3-bic" placeholder="SWIFT BIC" style="font-family:'IBM Plex Mono',monospace;font-size:12px"/></div>
        <div class="field-group"><label class="field-label">Hours of Negotiation</label><input type="text" id="w78-3-hours" placeholder="e.g. 24 hours"/></div>
      </div>
    </div>

    <div class="sg-grid2" style="row-gap:14px;margin-top:14px">
      <div class="field-group sg-full">
        <label class="field-label"><span class="badge-o">O</span> :72Z: Sender to Receiver Information</label>
        <textarea id="f-72Z" rows="3" placeholder="Additional bank-to-bank information (Z character set)"></textarea>
      </div>
    </div>

  </div><!-- /lc-fields -->

  <!-- ACTION BUTTONS -->
  <div class="sg-actions">
    <span class="actions-label">Actions:</span>
    <button class="sg-btn sg-btn-view" onclick="onView()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg> View Draft
    </button>
    <button class="sg-btn sg-btn-save" onclick="onSave()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Save Draft
    </button>
    <button class="sg-btn sg-btn-print" onclick="onPrint()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg> Print
    </button>
    <button class="sg-btn sg-btn-send" onclick="onSendClick()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg> Send
    </button>
  </div>

</div><!-- /swift-generator -->
</div><!-- /content-area -->

<!-- PREVIEW MODAL -->
<div class="modal-overlay" id="preview-modal">
  <div class="modal">
    <div class="modal-toolbar">
      <span>Draft SWIFT Message Preview</span>
      <div class="modal-toolbar-btns">
        <button class="modal-close" onclick="onPrint()">🖨 Print</button>
        <button class="modal-close" onclick="closeModal('preview-modal')">✕ Close</button>
      </div>
    </div>
    <div class="modal-body"><div class="draft-doc" id="draft-document"></div></div>
  </div>
</div>

<!-- SEND MODAL -->
<div class="modal-overlay" id="send-modal">
  <div class="email-modal">
    <div class="email-modal-header">
      <span>📨 Send Draft SWIFT Message</span>
      <button class="modal-close" onclick="closeModal('send-modal')">✕</button>
    </div>
    <div class="email-modal-body">
      <div class="field-group" id="fg-send-to">
        <label class="field-label"><span class="badge-m">M</span> Issuing Bank Email</label>
        <input type="email" id="send-to-email" placeholder="bank@example.com"/>
        <div class="field-help">Draft will be sent to this address.</div>
        <div class="error-msg">Please enter a valid email.</div>
      </div>
      <div class="field-group">
        <label class="field-label">CC (Auto)</label>
        <input type="text" value="info@tfsbd.com" readonly style="background:#f0f0f0;font-family:'IBM Plex Mono',monospace;font-size:12px;cursor:not-allowed"/>
        <div class="field-help">TFSBD automatically receives a copy for record keeping.</div>
      </div>
      <div style="background:var(--cream);border-radius:7px;padding:11px 13px;font-size:11px;color:var(--muted);border-left:3px solid var(--gold)">
        ⚠️ This is a <strong>draft copy</strong>. The recipient should verify all details before operational use.
      </div>
    </div>
    <div class="email-modal-footer">
      <button class="sg-btn sg-btn-view" style="border:1.5px solid var(--border)" onclick="closeModal('send-modal')">Cancel</button>
      <button class="sg-btn sg-btn-send" onclick="onSendConfirm()">Send Message</button>
    </div>
  </div>
</div>

<!-- REGISTRATION REQUIRED MODAL -->
<div class="modal-overlay" id="regModal">
  <div class="modal">
    <h3><i class="fas fa-id-card"></i> Registration Required</h3>
    <p style="margin-bottom:20px">You need to complete your company registration before submitting forms.</p>
    <p style="margin-bottom:20px;font-size:12px;color:var(--muted)">Please go to Settings and complete your registration.</p>
    <button class="btn btn-primary" onclick="closeModal('regModal'); navigateTo('settings')">Go to Settings</button>
    <button class="btn btn-outline" onclick="closeModal('regModal')">Cancel</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ─── BANK DATA ───
const BANKS = [
  {name:"AB Bank Ltd.",swift:"ABBLBDDH"},{name:"Agrani Bank PLC",swift:"AGRBBDDH"},
  {name:"Al-Arafah Islami Bank PLC",swift:"ALARBD22"},{name:"Bangladesh Development Bank Ltd.",swift:"BDBKBDDH"},
  {name:"Bangladesh Krishi Bank",swift:"BKBABDDH"},{name:"Bank Asia Ltd.",swift:"BALBBDDH"},
  {name:"BASIC Bank Ltd.",swift:"BSICBDDH"},{name:"BRAC Bank PLC",swift:"BRAKBDDH"},
  {name:"Citibank N.A. Bangladesh",swift:"CITIBDDX"},{name:"City Bank PLC",swift:"CIBLBDDH"},
  {name:"Commercial Bank of Ceylon PLC",swift:"CCEYBDDH"},{name:"Dhaka Bank PLC",swift:"DHBLBDDH"},
  {name:"Dutch-Bangla Bank PLC",swift:"DBBLBDDH"},{name:"Eastern Bank PLC",swift:"EBLDBDDH"},
  {name:"Exim Bank PLC",swift:"EXIMBDDH"},{name:"First Security Islami Bank PLC",swift:"FSIBBDDH"},
  {name:"Global Islami Bank PLC",swift:"GLIBIBDDH"},{name:"HSBC Bangladesh",swift:"HSBCBDDH"},
  {name:"ICB Islamic Bank Ltd.",swift:"BNIBBDDH"},{name:"IFIC Bank PLC",swift:"IFICBDDH"},
  {name:"Islami Bank Bangladesh PLC",swift:"IBBLBDDH"},{name:"Jamuna Bank PLC",swift:"JAMUBDDH"},
  {name:"Janata Bank PLC",swift:"JANBBDDH"},{name:"Mercantile Bank PLC",swift:"MBLBBDDH"},
  {name:"Midland Bank Ltd.",swift:"MDBKBDDH"},{name:"Modhumoti Bank PLC",swift:"MODHBDDH"},
  {name:"Mutual Trust Bank PLC",swift:"MTBKBDDH"},{name:"National Bank Ltd.",swift:"NBLBBDDH"},
  {name:"National Credit & Commerce Bank PLC",swift:"NCCBBDDH"},{name:"NRB Bank Ltd.",swift:"NRBLBDDH"},
  {name:"NRB Commercial Bank Ltd.",swift:"NRCBBDDH"},{name:"One Bank PLC",swift:"ONEBBDDH"},
  {name:"Prime Bank PLC",swift:"PRBLBDDH"},{name:"Pubali Bank PLC",swift:"PUBABDDH"},
  {name:"Rajshahi Krishi Unnayan Bank",swift:"RAJKBDDH"},{name:"Rupali Bank PLC",swift:"RUPABDDH"},
  {name:"Shahjalal Islami Bank PLC",swift:"SJBLBDDH"},{name:"Shimanto Bank Ltd.",swift:"SHBKBDDH"},
  {name:"Social Islami Bank PLC",swift:"SOIVBDDH"},{name:"Sonali Bank PLC",swift:"BSONBDDH"},
  {name:"Southeast Bank PLC",swift:"SEBDBDDH"},{name:"Standard Bank PLC",swift:"SDBLBDDH"},
  {name:"Standard Chartered Bank Bangladesh",swift:"SCBLBDDX"},{name:"State Bank of India Bangladesh",swift:"SBINBDDH"},
  {name:"The Premier Bank PLC",swift:"PREMBDDH"},{name:"Trust Bank PLC",swift:"TRUSBD22"},
  {name:"Union Bank PLC",swift:"UNBLBDDH"},{name:"United Commercial Bank PLC",swift:"UCBLBDDH"},
  {name:"Uttara Bank PLC",swift:"UTBLBDDH"},{name:"Woori Bank Bangladesh",swift:"HVBKBDDH"},
];

// ─── BANGLADESH PORTS ───
const BD_PORTS = [
  "Chattogram Port","Mongla Port","Payra Port","Dhaka","Chittagong","Sylhet",
  "Benapole","Hili","Bhomra","Sonamasjid","Tamabil","Akhaura","Bibiyana",
  "Teknaf","Kamalapur ICD","Dhaka Kamalapur","Pangaon ICD","Pangaon River Port",
];

// ─── MAJOR INTERNATIONAL PORTS ───
const INTL_PORTS = [
  "Hamburg, Germany","Rotterdam, Netherlands","Antwerp, Belgium","Singapore",
  "Shanghai, China","Guangzhou, China","Shenzhen, China","Tianjin, China",
  "Ningbo, China","Qingdao, China","Hong Kong","Busan, South Korea",
  "Tokyo, Japan","Osaka, Japan","Port Klang, Malaysia","Tanjung Pelepas, Malaysia",
  "Colombo, Sri Lanka","Mumbai, India","Nhava Sheva (JNPT), India","Chennai, India",
  "Kolkata, India","Dubai (Jebel Ali), UAE","Abu Dhabi, UAE","Salalah, Oman",
  "Jeddah, Saudi Arabia","Dammam, Saudi Arabia","Istanbul, Turkey","Piraeus, Greece",
  "Barcelona, Spain","Valencia, Spain","Genoa, Italy","Naples, Italy",
  "Le Havre, France","Marseille, France","Felixstowe, UK","Southampton, UK",
  "New York/Newark, USA","Los Angeles, USA","Long Beach, USA","Houston, USA",
  "Vancouver, Canada","Sydney, Australia","Melbourne, Australia",
  "Durban, South Africa","Lagos, Nigeria","Mombasa, Kenya",
  "Tokyo Narita Airport","Dubai International Airport","Frankfurt Airport","London Heathrow Airport",
  "Singapore Changi Airport","Hong Kong International Airport",
];

// ─── CURRENCIES ───
const CURRENCIES = [
  "USD","EUR","GBP","JPY","CNY","CHF","CAD","AUD","SGD","HKD",
  "AED","SAR","MYR","INR","BDT","PKR","LKR","THB","IDR","PHP",
  "KRW","TRY","ZAR","NGN","EGP","KWD","OMR","QAR","BHD","JOD",
];

// ─── COUNTRIES ───
const COUNTRIES = [
  "Afghanistan","Albania","Algeria","Argentina","Australia","Austria","Bangladesh",
  "Belgium","Brazil","Cambodia","Canada","Chile","China","Colombia","Croatia",
  "Czech Republic","Denmark","Egypt","Finland","France","Germany","Ghana","Greece",
  "Hungary","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Japan",
  "Jordan","Kenya","Kuwait","Malaysia","Mexico","Morocco","Myanmar","Netherlands",
  "New Zealand","Nigeria","Norway","Oman","Pakistan","Philippines","Poland",
  "Portugal","Qatar","Romania","Russia","Saudi Arabia","Singapore","South Africa",
  "South Korea","Spain","Sri Lanka","Sweden","Switzerland","Thailand","Turkey",
  "Ukraine","United Arab Emirates","United Kingdom","United States","Vietnam",
  "Yemen","Zimbabwe",
];

// ─── PAGE TITLES ───
const PAGE_TITLES = {
  'dashboard':'Dashboard Overview',
  'trade-quote':'Trade Quote Request',
  'applications':'My Applications',
  'company-info':'Company Information',
  'lc-application':'LC Application',
  'project-finance':'Project Finance',
  'swift-generator':'Swift Message Generator',
  'help':'Help & Support',
  'settings':'Settings'
};

// Global state
let currentUser = null;
let currentPanel = 'customer';
let applications = [];

// Admin credentials
const ADMIN_EMAIL = 'a.karim@tfsbd.com';
const ADMIN_PASSWORD = 'Makultra2026!';

// Google Sheet URL
const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1kwio0S7hTT-U7KYS2ooltdrbqwLK7nrKcKlHUA01UWs/edit?usp=drive_link';

// ─── INIT ───
(function init(){
  document.getElementById('gen-date').value = new Date().toISOString().slice(0,10);

  // Populate bank dropdowns
  const bankSelectors = ['sel-sender','f-51A','d46B-bank','d46B-notify','w78-1-bank','w78-3-via','w78-3-dest'];
  bankSelectors.forEach(id=>{
    const sel = document.getElementById(id);
    if(!sel) return;
    BANKS.forEach(b=>{
      const o = new Option(b.name, b.swift);
      sel.add(o);
    });
  });

  // Bangladesh ports
  ['f-44A-sel','f-44B-sel'].forEach(id=>{
    const sel = document.getElementById(id);
    BD_PORTS.forEach(p=>sel.add(new Option(p,p)));
  });

  // International ports
  ['f-44E-sel','f-44F-sel'].forEach(id=>{
    const sel = document.getElementById(id);
    INTL_PORTS.forEach(p=>sel.add(new Option(p,p)));
  });

  // Currencies
  const ccySel = document.getElementById('f-32B-ccy');
  CURRENCIES.forEach(c=>ccySel.add(new Option(c,c)));

  // Countries
  ['d46A-country','c47-13-country'].forEach(id=>{
    const sel = document.getElementById(id);
    if(!sel) return;
    COUNTRIES.forEach(c=>sel.add(new Option(c,c)));
  });

  // Navigation
  document.querySelectorAll('[data-page]').forEach(el=>{
    el.addEventListener('click',function(e){
      e.preventDefault();
      navigateTo(this.getAttribute('data-page'));
    });
  });

 // Change from logoutBtn to loginBtn
document.getElementById('loginBtn').addEventListener('click', function(){
  // Simple demo login modal/prompt
  const userType = prompt('Select user type:\n1 for Owner\n2 for Agent\n3 for Guest Demo', '1');
  
  let userData;
  
  if (userType === '1') {
    userData = {
      type: 'owner',
      fullName: 'John Doe',
      companyName: 'Global Trading Co.',
      email: 'owner@globaltrading.com',
      phone: '+880 1712 345678',
      address: '123 Business Street, Dhaka',
      tradeLicense: 'TL-2024-001234',
      tin: '123-456-789'
    };
    showToast('Logged in as Owner');
  } 
  else if (userType === '2') {
    userData = {
      type: 'agent',
      fullName: 'Sarah Ahmed',
      companyName: 'TradeLink Agency',
      email: 'agent@tradelink.com',
      phone: '+880 1812 345678',
      address: '456 Commercial Area, Chattogram',
      tradeLicense: 'AG-2024-005678',
      tin: '987-654-321'
    };
    showToast('Logged in as Agent');
  }
  else {
    // Guest/demo login - limited access
    userData = {
      type: 'guest',
      fullName: 'Guest User',
      companyName: 'Guest Access',
      email: 'guest@example.com'
    };
    showToast('Logged in as Guest (limited access)');
  }
  
  currentUser = userData;
  localStorage.setItem('tfsbd_user', JSON.stringify(userData));
  updateUI();
  navigateTo('dashboard');
});

  document.querySelectorAll('.modal-overlay').forEach(el=>{
    el.addEventListener('click',function(e){if(e.target===this)this.classList.remove('active');});
  });

  // Upload drag events
  const ub = document.getElementById('upload-box');
  if(ub) {
    ub.addEventListener('dragover',e=>{e.preventDefault();ub.classList.add('drag-over');});
    ub.addEventListener('dragleave',()=>ub.classList.remove('drag-over'));
    ub.addEventListener('drop',e=>{e.preventDefault();ub.classList.remove('drag-over');});
  }

  // Load saved user data
  const savedUser = localStorage.getItem('tfsbd_user');
  if (savedUser) {
    currentUser = JSON.parse(savedUser);
  }
  
  updateUI();
  navigateTo('dashboard');
})();

// ─── PANEL SWITCHING ───
function switchPanel(panel) {
  currentPanel = panel;
  
  document.querySelectorAll('.panel-btn').forEach(btn => btn.classList.remove('active'));
  if (panel === 'admin') {
    document.querySelectorAll('.panel-btn')[1].classList.add('active');
    document.getElementById('currentPanel').textContent = 'ADMIN PANEL';
    document.getElementById('currentPanel').className = 'panel-tag admin';
    
    if (!currentUser || currentUser.email !== ADMIN_EMAIL) {
      const adminPass = prompt('Enter Admin Password:');
      if (adminPass === ADMIN_PASSWORD) {
        currentUser = {
          type: 'admin',
          email: ADMIN_EMAIL,
          companyName: 'TFSBD Administration',
          fullName: 'A. Karim'
        };
        localStorage.setItem('tfsbd_user', JSON.stringify(currentUser));
        showToast('Admin panel activated');
      } else {
        switchPanel('customer');
        return;
      }
    }
  } else {
    document.querySelectorAll('.panel-btn')[0].classList.add('active');
    document.getElementById('currentPanel').textContent = 'CUSTOMER PANEL';
    document.getElementById('currentPanel').className = 'panel-tag customer';
  }
  
  updateUI();
}

// ─── NAVIGATION ───
function navigateTo(pageId){
  document.querySelectorAll('.page-content').forEach(p => { p.style.display = 'none'; });
  const target = document.getElementById(pageId);
  if (target) target.style.display = 'block';
  
  document.querySelectorAll('.leftnav, .leftnavon').forEach(n => {
    n.className = n.classList.contains('nav-swift') ? 'leftnav nav-swift' : 'leftnav';
  });
  
  const active = document.querySelector(`[data-page="${pageId}"]`);
  if (active) {
    active.className = active.classList.contains('nav-swift') ? 'leftnavon nav-swift' : 'leftnavon';
  }
  
  document.getElementById('pageSubtitle-display').textContent = PAGE_TITLES[pageId] || '';
  
  if(pageId === 'swift-generator') {
    showLCFields();
  }
}

function showLCFields(){
  document.getElementById('lc-fields').style.display='block';
}

// ─── UPDATE UI ───
function updateUI() {
  const userBadge = document.getElementById('userBadge');
  const regBanner = document.getElementById('regBanner');
  const userName = document.getElementById('userName');
  const userTypeBadge = document.getElementById('userTypeBadge');
  
  if (currentUser) {
    userBadge.style.display = 'flex';
    regBanner.style.display = 'none';
    userName.textContent = currentUser.fullName || currentUser.companyName || 'User';
    
    if (currentUser.type === 'agent') {
      userTypeBadge.textContent = 'Agent';
      userTypeBadge.className = 'user-type-badge user-agent';
    } else if (currentUser.type === 'owner') {
      userTypeBadge.textContent = 'Owner';
      userTypeBadge.className = 'user-type-badge user-owner';
    } else if (currentUser.type === 'admin') {
      userTypeBadge.textContent = 'Admin';
      userTypeBadge.className = 'user-type-badge';
    }
    
    document.getElementById('infoCompanyName').textContent = currentUser.companyName || '-';
    document.getElementById('infoUserType').textContent = currentUser.type || '-';
    document.getElementById('infoContactPerson').textContent = currentUser.fullName || '-';
    document.getElementById('infoEmail').textContent = currentUser.email || '-';
    document.getElementById('infoPhone').textContent = currentUser.phone || '-';
    document.getElementById('infoAddress').textContent = currentUser.address || '-';
    document.getElementById('infoTradeLicense').textContent = currentUser.tradeLicense || '-';
    document.getElementById('infoTIN').textContent = currentUser.tin || '-';
    
    document.getElementById('dashboardCompany').textContent = currentUser.companyName || 'Registered';
    document.getElementById('dashboardUserType').textContent = 
      currentUser.type === 'agent' ? 'Agent' : (currentUser.type === 'owner' ? 'Owner' : 'User');
    document.getElementById('dashboardStatus').textContent = 'Active';
    
  } else {
    userBadge.style.display = 'none';
    regBanner.style.display = 'flex';
    
    document.getElementById('infoCompanyName').textContent = '-';
    document.getElementById('infoUserType').textContent = '-';
    document.getElementById('dashboardCompany').textContent = 'Not Registered';
    document.getElementById('dashboardUserType').textContent = 'Guest';
    document.getElementById('dashboardStatus').textContent = 'Registration Required';
  }
  
  loadApplications();
}

// ─── REGISTRATION ───
function handleRegistration(event) {
  event.preventDefault();
  
  const userData = {
    type: document.getElementById('reg-userType').value,
    fullName: document.getElementById('reg-fullName').value,
    companyName: document.getElementById('reg-companyName').value,
    email: document.getElementById('reg-email').value,
    phone: document.getElementById('reg-phone').value,
    address: document.getElementById('reg-address').value,
    tradeLicense: document.getElementById('reg-tradeLicense').value,
    tin: document.getElementById('reg-tin').value,
    password: document.getElementById('reg-password').value,
    registered: new Date().toISOString()
  };
  
  if (!userData.type || !userData.fullName || !userData.companyName || !userData.email || !userData.phone || !userData.address) {
    showToast('Please fill all required fields', '#c0392b');
    return;
  }
  
  if (userData.password.length < 6) {
    showToast('Password must be at least 6 characters', '#c0392b');
    return;
  }
  
  currentUser = userData;
  localStorage.setItem('tfsbd_user', JSON.stringify(userData));
  
  console.log('Sending to Google Sheet:', GOOGLE_SHEET_URL, userData);
  
  showToast('Registration successful!');
  updateUI();
  navigateTo('company-info');
}

// ─── FORM SUBMISSION ───
function handleFormSubmit(event, formType) {
  event.preventDefault();
  
  if (!currentUser) {
    document.getElementById('regModal').classList.add('active');
    return;
  }
  
  let formData = {};
  
  if (formType === 'trade-quote') {
    formData = {
      type: 'Trade Quote',
      firstName: document.getElementById('tq-firstName')?.value,
      lastName: document.getElementById('tq-lastName')?.value,
      email: document.getElementById('tq-email')?.value,
      mobile: document.getElementById('tq-mobile')?.value,
      transactionType: document.getElementById('tq-transactionType')?.value,
      amount: document.getElementById('tq-amount')?.value,
      submitted: new Date().toISOString(),
      userEmail: currentUser.email
    };
  } else if (formType === 'project-finance') {
    formData = {
      type: 'Project Finance',
      fullName: document.getElementById('pf-fullName')?.value,
      companyName: document.getElementById('pf-companyName')?.value,
      email: document.getElementById('pf-email')?.value,
      amount: document.getElementById('pf-amount')?.value,
      submitted: new Date().toISOString(),
      userEmail: currentUser.email
    };
    
    if (!document.querySelector('input[name="acceptTerms"]').checked) {
      showToast('Please accept the terms and conditions', '#c0392b');
      return;
    }
  } else if (formType === 'lc-application') {
    formData = {
      type: 'LC Application',
      applicant: document.getElementById('lc-applicant')?.value,
      lcType: document.getElementById('lc-type')?.value,
      amount: document.getElementById('lc-amount')?.value,
      beneficiary: document.getElementById('lc-beneficiary')?.value,
      submitted: new Date().toISOString(),
      userEmail: currentUser.email
    };
  }
  
  const appId = 'APP-' + Date.now().toString(36).toUpperCase();
  const newApp = {
    id: appId,
    ...formData,
    status: 'submitted'
  };
  
  applications.push(newApp);
  localStorage.setItem('tfsbd_applications', JSON.stringify(applications));
  
  console.log('Sending to Google Sheet:', GOOGLE_SHEET_URL, newApp);
  
  showToast(`${formType} submitted successfully!`);
  
  if (event.target) {
    event.target.reset();
  }
  
  setTimeout(() => navigateTo('applications'), 1500);
}

// ─── LOAD APPLICATIONS ───
function loadApplications() {
  const saved = localStorage.getItem('tfsbd_applications');
  if (saved) {
    applications = JSON.parse(saved);
  }
  
  const tbody = document.getElementById('applicationsList');
  if (!tbody) return;
  
  let userApps = applications;
  if (currentPanel === 'customer' && currentUser) {
    userApps = applications.filter(app => app.userEmail === currentUser.email);
  }
  
  if (userApps.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:20px">No applications found</td></tr>';
    document.getElementById('dashboardQuotes').textContent = '0';
    document.getElementById('dashboardProjects').textContent = '0';
    document.getElementById('dashboardLCs').textContent = '0';
    return;
  }
  
  let html = '';
  let quoteCount = 0, projectCount = 0, lcCount = 0;
  
  userApps.forEach(app => {
    if (app.type === 'Trade Quote') quoteCount++;
    if (app.type === 'Project Finance') projectCount++;
    if (app.type === 'LC Application') lcCount++;
    
    html += `<tr>
      <td>${app.type}</td>
      <td>${app.id || 'N/A'}</td>
      <td>${app.submitted ? new Date(app.submitted).toLocaleDateString() : '-'}</td>
      <td><span class="status-badge status-submitted">Submitted</span></td>
      <td><button class="btn btn-primary" style="font-size:11px;padding:5px 10px" onclick="showToast('View details')">View</button></td>
    </tr>`;
  });
  
  tbody.innerHTML = html;
  document.getElementById('dashboardQuotes').textContent = quoteCount;
  document.getElementById('dashboardProjects').textContent = projectCount;
  document.getElementById('dashboardLCs').textContent = lcCount;
  
  if (userApps.length > 0) {
    document.getElementById('dashboardLatest').textContent = userApps[userApps.length-1].type || '-';
    document.getElementById('dashboardDate').textContent = new Date(userApps[userApps.length-1].submitted).toLocaleDateString();
  }
}

// ─── LOGO PREVIEW ───
function previewLogo(input) {
  const preview = document.getElementById('logoPreview');
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.style.display = 'block';
      preview.querySelector('img').src = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
  }
}

// ─── MODAL ───
function closeModal(id) {
  document.getElementById(id).classList.remove('active');
}

// ─── TOAST ───
function showToast(msg, bg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.background = bg || '#1a6b3a';
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3800);
}

// ─── SWIFT GENERATOR FUNCTIONS ───

// Invoice upload
function onInvoiceUpload(input){
  const file = input.files[0];
  if(!file) return;
  const status = document.getElementById('upload-status');
  status.className='upload-status processing';
  status.textContent='⏳ Processing invoice... extracting fields...';

  setTimeout(()=>{
    const mockApplicant = 'Global Trading Co.\n123 Commerce Street\nKawran Bazar, Dhaka 1215\nBangladesh\nTIN: 123-456-789 | BIN: 987-654-321';
    const mockBeneficiary = 'ABC Exports Ltd.\n45 Industrial Avenue\nHamburg 20095\nGermany\nEmail: sales@abcexports.de';
    const mockGoods = 'Polypropylene Granules\nHS Code: 3902.10\nQuantity: 100 MT\nUnit Price: USD 500.00/MT\nTotal: USD 50,000.00\nOrigin: Germany';
    const mockAmt = '50000,00';
    const mockCcy = 'USD';
    const mockDeferred = 'Payment to be made at sight basis upon presentation of compliant documents.';

    safeSet('f-50', mockApplicant);
    safeSet('f-59', mockBeneficiary);
    safeSet('f-45A', mockGoods);
    safeSet('f-32B-amt', mockAmt);
    const ccySel = document.getElementById('f-32B-ccy');
    for(let i=0;i<ccySel.options.length;i++){
      if(ccySel.options[i].value===mockCcy){ccySel.selectedIndex=i;break;}
    }
    safeSet('f-42P', mockDeferred);

    ['autofill-50','autofill-59','autofill-45A','autofill-42P','autofill-44A'].forEach(id=>{
      const el=document.getElementById(id);
      if(el) el.style.display='block';
    });

    status.className='upload-status success';
    status.textContent=`✅ "${file.name}" uploaded — PDF processed. Key fields auto-filled below.`;
    showToast('✅ Invoice processed — fields auto-filled');
  }, 1800);
}

function safeSet(id, val){
  const el = document.getElementById(id);
  if(el) el.value = val;
}

// Sender functions
function onSenderChange(){
  const sel = document.getElementById('sel-sender');
  const swift = sel.value;
  document.getElementById('sender-swift').value = swift||'';
  const preview = document.getElementById('sender-swift-preview');
  if(swift){preview.textContent='⚡ BIC: '+swift;preview.style.display='block';}
  else preview.style.display='none';
  document.getElementById('sender-bic-manual-row').style.display='none';
  document.getElementById('sender-manual').style.display='none';
}

let senderManualMode = false;
function toggleSenderManual(){
  senderManualMode = !senderManualMode;
  const manualInp = document.getElementById('sender-manual');
  const bicRow = document.getElementById('sender-bic-manual-row');
  const sel = document.getElementById('sel-sender');
  if(senderManualMode){
    manualInp.style.display='block';
    bicRow.style.display='block';
    sel.value='';
    document.getElementById('sender-swift').value='';
    document.getElementById('sender-swift-preview').style.display='none';
    manualInp.focus();
  } else {
    manualInp.style.display='none';
    bicRow.style.display='none';
  }
}

function onSenderManualInput(){
  const bic = document.getElementById('sender-swift-manual').value;
  if(!bic) document.getElementById('sender-swift').value='';
}

// Applicant Bank
function onApplicantBankChange(){
  const sel = document.getElementById('f-51A');
  const bic = sel.value;
  const preview = document.getElementById('appbank-preview');
  document.getElementById('f-42A').value = bic||'';
  if(bic){preview.textContent='⚡ BIC: '+bic;preview.style.display='block';}
  else preview.style.display='none';
}

// Port functions
function togglePortManual(field){
  const inp = document.getElementById('f-'+field);
  const isHidden = inp.style.display==='none'||inp.style.display==='';
  inp.style.display = isHidden ? 'block' : 'none';
  if(isHidden) inp.focus();
}

function syncPortField(selId, inputId){
  const val = document.getElementById(selId).value;
  document.getElementById(inputId).value = val;
}

function onMsgTypeChange(){
  showLCFields();
}

// Helper functions for Swift generation
function g(id){const el=document.getElementById(id);return el?el.value.trim():'';}
function gMulti(id){
  const el=document.getElementById(id);
  if(!el) return '';
  return Array.from(el.selectedOptions).map(o=>o.value).join(', ');
}

function buildDocuments46A(){
  let lines=[];
  const country=g('d46A-country'),lcno=g('d46A-lcno'),dt=g('d46A-date');
  if(country||lcno) lines.push(`(A) BENEFICIARY'S SIGNED COMMERCIAL INVOICES IN OCTUPLICATE, CERTIFYING MERCHANDISE TO BE OF ${country||'[COUNTRY]'} ORIGIN, H.S. CODE, AND LC NO. ${lcno||'[LC NO]'}${dt?' DATED '+dt:''} MUST APPEAR ON INVOICES.`);
  const bbank=g('d46B-bank'),bnotify=g('d46B-notify');
  if(bbank||bnotify) lines.push(`(B) FULL SET OF PACKAGING LIST & BILL OF LADING, DULY VALIDATED, DRAWN ON OR ENDORSED TO THE ORDER OF ${bbank||'[BANK]'}, SHOWING "FREIGHT PREPAID" AND MARKED NOTIFY APPLICANT AND ${bnotify||'[BANK BRANCH]'}.`);
  const cemail=g('d46C-email'),coverno=g('d46C-coverno'),cdate=g('d46C-date');
  if(cemail||coverno) lines.push(`(C) INSURANCE COVERED BY THE APPLICANT. ALL SHIPMENT UNDER THIS CREDIT MUST BE ADVISED BY THE BENEFICIARY WITHIN 5 (FIVE) DAYS AFTER SHIPMENT BY EMAIL TO ${cemail||'[INSURANCE EMAIL]'}, THE APPLICANT, AND TO US QUOTING THIS CREDIT NUMBER AND REFERRING TO ${coverno||'[COVER NOTE NO]'}${cdate?' DATED '+cdate:''}. A COPY OF SUCH ADVICE MUST BE PRESENTED WITH THE ORIGINAL SHIPPING DOCUMENTS.`);
  lines.push(`(D) CERTIFICATE OF ORIGIN ISSUED BY CONCERNED GOVERNMENT/AUTHORIZED AUTHORITY/ORGANIZATION (E.G., CHAMBER OF COMMERCE OF EXPORTING COUNTRY) MUST BE PRESENTED WITH THE ORIGINAL SHIPPING DOCUMENTS.`);
  lines.push(`(E) PACKING LIST IN 5 (FIVE) COPIES SHOWING NET AND GROSS WEIGHT.`);
  const ftin=g('d46F-tin'),fbin=g('d46F-bin');
  if(ftin||fbin) lines.push(`(F) BENEFICIARY'S CERTIFICATE STATING THAT COUNTRY OF ORIGIN, NAME AND ADDRESS OF THE APPLICANT ALONG WITH APPLICANT'S TIN ${ftin||'[TIN]'} AND BIN ${fbin||'[BIN]'} HAS BEEN CLEARLY MENTIONED WITH INDELIBLE INK ON THE SURFACE OF AT LEAST 2 PERCENT CARTON/CONTAINER/PACK/BAG/ROLL. THIS CERTIFICATE MUST BE PRESENTED WITH THE ORIGINAL SHIPPING DOCUMENTS.`);
  const gemail=g('d46G-appl-email'),gbemail=g('d46G-bank-email');
  if(gemail||gbemail) lines.push(`(G) A FULL SET OF NON-NEGOTIABLE SHIPPING DOCUMENTS MUST BE SENT DIRECTLY TO THE APPLICANT BY COURIER/EMAIL WITHIN 5 (FIVE) WORKING DAYS AFTER SHIPMENT AND ALSO TO EMAIL ID: ${gemail||'[APPLICANT EMAIL]'} AND COPY TO ${gbemail||'[BANK EMAIL]'}. A CERTIFICATE TO THIS EFFECT ISSUED BY THE BENEFICIARY MUST BE ENCLOSED WITH ORIGINAL SHIPPING DOCUMENTS.`);
  lines.push(`(H) A GUARANTEE/WARRANTY CERTIFICATE ISSUED BY THE BENEFICIARY STATING THAT THE GOODS ARE BRAND NEW, FREE FROM ANY MANUFACTURING DEFECT, AND IN GOOD RUNNING CONDITION. THE BENEFICIARY MUST UNDERTAKE WARRANTY OF REPLACEMENT FREE OF COST FOR ANY GOODS DUE TO MANUFACTURING DEFECT FOR A PERIOD OF 12 (TWELVE) MONTHS FROM THE DATE OF COMMISSIONING OR 18 (EIGHTEEN) MONTHS FROM THE DATE OF SHIPMENT, WHICHEVER IS EARLIER.`);
  return lines.join('\n');
}

function buildConditions47A(){
  let lines=[];
  const d1=g('c47-1-date'); if(d1) lines.push(`(1) SHIPMENT MUST NOT BE MADE BEFORE ${d1}.`);
  const lc2=g('c47-2-lcno'),dt2=g('c47-2-date'); if(lc2||dt2) lines.push(`(2) LC NUMBER ${lc2||'[LC NO]'} AND DATE ${dt2||'[DATE]'} MUST BE MENTIONED IN ALL SHIPPING DOCUMENTS.`);
  const tin3=g('c47-3-tin'),bin3=g('c47-3-bin'); if(tin3||bin3) lines.push(`(3) APPLICANT TIN ${tin3||'[TIN]'} AND BIN ${bin3||'[BIN]'} SHOULD BE MENTIONED IN ALL SHIPPING DOCUMENTS.`);
  const a4=g('c47-4-amt'); lines.push(`(4) AN AMOUNT OF USD ${a4||'100.00'} AS DISCREPANCY CHARGES WILL BE DEDUCTED FROM BILL VALUE AT THE TIME OF PAYMENT FOR EACH SET OF DISCREPANT DOCUMENTS, IF ACCEPTED AND/OR PAID.`);
  const inv5=g('c47-5-invno'); if(inv5) lines.push(`(5) BENEFICIARY MUST CERTIFY ON INVOICE ${inv5} THAT QUALITY, QUANTITY, RATE, PACKING, MARKING AND ALL OTHER DETAILS OF GOODS ARE STRICTLY IN ACCORDANCE WITH THE LC AND PROFORMA INVOICE.`);
  lines.push(`(6) BENEFICIARY MUST CERTIFY IN THE COMMERCIAL INVOICES THAT NO COMMISSION IS INCLUDED IN THIS ISSUE AND THE PRICE IS NET.`);
  const lang7=g('c47-7-lang'); if(lang7) lines.push(`(7) ALL DOCUMENTS MUST BE PREPARED IN ${lang7}.`);
  const fob8=g('c47-8-fob'),fr8=g('c47-8-freight'); if(fob8||fr8) lines.push(`(8) INVOICE MUST INDICATE FOB VALUE ${fob8||'[FOB VALUE]'} AND FREIGHT CHARGE ${fr8||'[FREIGHT CHARGE]'} SEPARATELY WITH THE TOTAL VALUE.`);
  const pk9=g('c47-9-pack'); if(pk9) lines.push(`(9) PACKING: ${pk9.toUpperCase()}.`);
  lines.push(`(10) DOCUMENTS SENT DIRECTLY BY THE BENEFICIARY WILL NOT BE ENTERTAINED AND WILL BE RETURNED.`);
  const a11=g('c47-11-amt'); lines.push(`(11) USD ${a11||'100.00'} WILL BE DEDUCTED FROM THE BILL AMOUNT OF EACH SET OF DOCUMENTS BEING OUR PAYMENT PROCESSING CHARGE AT THE TIME OF PAYMENT.`);
  const laws=gMulti('c47-12-law'); if(laws) lines.push(`(12) PRESENTATION OF DOCUMENT(S) THAT ARE NOT IN COMPLIANCE WITH APPLICABLE ${laws} IS NOT ACCEPTABLE. APPLICABLE LAWS VARY DEPENDING ON THE TRANSACTION AND MAY INCLUDE UNITED NATIONS, UNITED STATES AND/OR LOCAL LAWS.`);
  const ctr13=g('c47-13-country'); if(ctr13) lines.push(`(13) GOODS FROM ${ctr13.toUpperCase()} OR GOODS PRODUCED IN THAT COUNTRY AND ALSO GOODS CARRIED IN THE FLAG VESSELS OF THAT COUNTRY ARE STRICTLY PROHIBITED.`);
  const ca14=g('c47-14-amt'); if(ca14) lines.push(`(14) CREDIT AMOUNT NOT EXCEEDING ${ca14}.`);
  const tenor=g('c47-15-tenor'); lines.push(`(15) ALTHOUGH THE TENOR IS AT ${tenor||'360'} DAYS FROM THE DATE OF LC ISSUANCE, THE CONFIRMING BANK WILL DISCOUNT AND PAY THE BILL VALUE TO THE BENEFICIARY AT SIGHT BASIS ON PRESENTATION OF DOCUMENTS COMPLYING CREDIT TERMS. CONFIRMATION AND DISCOUNTING CHARGES ARE ON APPLICANT'S ACCOUNT WHICH WILL BE PAID AT MATURITY ALONG WITH THE BILL VALUE. THIS ARRANGEMENT IS APPLICABLE ONLY IF DOCUMENTS ARE ROUTED THROUGH THE CONFIRMING BANK.`);
  return lines.join('\n');
}

function buildInstructions78(){
  let lines=[];
  const acno=g('w78-1-acno'),bk=g('w78-1-bank'),bic=g('w78-1-bic'),mat=g('w78-1-maturity'),days=g('w78-1-days');
  if(acno||bk) lines.push(`(I) IN REIMBURSEMENT PLEASE DRAW ON OUR U.S. DOLLAR A/C NO. ${acno||'[A/C NO]'} WITH ${bk||'[BANK]'} (BIC: ${bic||'[BIC]'}) ON ${mat||'[MATURITY DATE]'}, CERTIFYING STRICT COMPLIANCE OF CREDIT TERMS AND GIVING AT LEAST ${days||'[X WORKING DAYS]'} PRIOR NOTICE TO US.`);
  const ref2=g('w78-2-ref'); if(ref2) lines.push(`(II) EACH NEGOTIATION ${ref2} TO BE ENDORSED ON THE REVERSE OF THIS CREDIT.`);
  const via=g('w78-3-via'),dest=g('w78-3-dest'),tel=g('w78-3-tel'),sw=g('w78-3-bic'),hrs=g('w78-3-hours');
  if(via||dest) lines.push(`(III) DOCUMENTS TO BE SENT THROUGH ${via||'[CONFIRMING BANK]'} TO THE ${dest||'[BANK & BRANCH]'}, TEL: ${tel||'[TEL]'}, SWIFT BIC: ${sw||'[BIC]'}, WITHIN ${hrs||'[X HOURS]'} OF NEGOTIATION.`);
  return lines.join('\n');
}

function collectAllFields(){
  const mt = g('sel-msgtype')||'MT700';
  const senderBIC = g('sender-swift');
  const senderSel = document.getElementById('sel-sender');
  const senderName = senderSel ? (senderSel.options[senderSel.selectedIndex]?.text||g('sender-manual')||'') : '';
  const recvName = g('recv-name');
  const recvSwift = document.getElementById('recv-swift').value.trim().toUpperCase();
  const recvAddr = g('recv-addr');
  const genDate = g('gen-date');

  const fields = [];
  function addF(tag,val){if(val&&val.trim()) fields.push({tag,value:val.trim()});}

  addF('27',g('f-27'));
  addF('40A',g('f-40A'));
  addF('20',g('f-20'));
  addF('23',g('f-23'));
  addF('31C',g('f-31C'));
  addF('40E',g('f-40E'));
  addF('31D',g('f-31D'));
  addF('51A',g('f-51A'));
  addF('50',g('f-50'));
  addF('59',g('f-59'));
  const ccy=g('f-32B-ccy'),amt=g('f-32B-amt');
  if(ccy&&amt) addF('32B',ccy+' '+amt);
  addF('39A',g('f-39A'));
  addF('39C',g('f-39C'));
  addF('41A',g('f-41A'));
  addF('42C',g('f-42C'));
  addF('42A',g('f-42A'));
  addF('42M',g('f-42M'));
  addF('42P',g('f-42P'));
  addF('43P',g('f-43P'));
  addF('43T',g('f-43T'));
  addF('44A',g('f-44A')||g('f-44A-sel'));
  addF('44E',g('f-44E')||g('f-44E-sel'));
  addF('44F',g('f-44F')||g('f-44F-sel'));
  addF('44B',g('f-44B')||g('f-44B-sel'));
  addF('44C',g('f-44C'));
  addF('44D',g('f-44D'));
  addF('45A',g('f-45A'));
  const docs46 = buildDocuments46A(); addF('46A',docs46);
  const cond47 = buildConditions47A(); addF('47A',cond47);
  addF('71D',g('f-71D'));
  addF('48',g('f-48'));
  addF('49',g('f-49'));
  addF('58a',g('f-58a'));
  addF('53a',g('f-53a'));
  addF('57A',g('f-57A'));
  const ins78 = buildInstructions78(); addF('78',ins78);
  addF('72Z',g('f-72Z'));

  return {mt,senderBIC,senderName,recvName,recvSwift,recvAddr,genDate,fields};
}

// Validate
function validate(){
  let ok=true;
  function setErr(id,has){const el=document.getElementById(id);if(!el)return;el.classList.toggle('has-error',has);}
  const sender=g('sender-swift')||g('sender-manual');
  setErr('fg-sender',!sender); if(!sender) ok=false;
  const rn=g('recv-name'); setErr('fg-recv-name',!rn); if(!rn) ok=false;
  const rs=g('recv-swift'); setErr('fg-recv-swift',!rs); if(!rs) ok=false;
  const mt=g('sel-msgtype'); setErr('fg-msgtype',!mt); if(!mt) ok=false;
  if(!g('f-20')) ok=false;
  if(!g('f-40A')) ok=false;
  if(!g('f-50')) ok=false;
  if(!g('f-59')) ok=false;
  return ok;
}

// Build draft HTML
function buildDraftHTML(data){
  const{mt,senderBIC,senderName,recvName,recvSwift,recvAddr,genDate,fields}=data;
  const now=new Date();
  const dateStr=genDate||now.toISOString().slice(0,10);
  const timeStr=now.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});

  let swiftText=`{1:F01${senderBIC}0000000000}\n{2:I${mt}${recvSwift}N}\n{4:\n`;
  fields.forEach(f=>{
    const lines=f.value.split('\n');
    swiftText+=`:${f.tag}:${lines[0]}\n`;
    lines.slice(1).forEach(l=>{if(l.trim()) swiftText+=`        ${l}\n`;});
  });
  swiftText+=`-}`;

  const swiftHL = swiftText
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/\{/g,'<span style="color:rgba(255,255,255,.3)">{</span>')
    .replace(/\}/g,'<span style="color:rgba(255,255,255,.3)">}</span>')
    .replace(/:([0-9A-Za-z]{2,5}):/g,'<span style="color:#e8c96d;font-weight:700">:$1:</span>');

  return `
<div class="draft-header">
  <div class="draft-logo">TF</div>
  <div class="draft-header-text">
    <strong>Trade Finance Solution Bangladesh (TFSBD)</strong>
    <span>Swift Message Generator – Draft Copy</span>
  </div>
</div>
<div class="draft-watermark">⚠ Draft Copy — Not for Operational Use ⚠</div>
<div class="draft-content">
  <div class="draft-meta">
    <div class="draft-meta-item"><strong>Message Type</strong>${mt}</div>
    <div class="draft-meta-item"><strong>Generated</strong>${dateStr} ${timeStr}</div>
    <div class="draft-meta-item"><strong>Sender BIC</strong>${senderBIC||'—'}</div>
    <div class="draft-meta-item"><strong>Sender Bank</strong>${senderName||'—'}</div>
    <div class="draft-meta-item"><strong>Receiver</strong>${recvName} (${recvSwift})</div>
    ${recvAddr?`<div class="draft-meta-item"><strong>Receiver Addr</strong>${recvAddr}</div>`:''}
  </div>
  <div class="swift-block">${swiftHL}</div>
</div>
<div class="draft-footer">
  <div class="draft-footer-top">This application is owned and operated by Trade Finance Solution Bangladesh (TFSBD).</div>
  <div class="draft-footer-addr">
    <div><strong>Dhaka Office</strong>Level 12, Rangs Bhaban<br>113 Kazi Nazrul Islam Ave<br>Kawran Bazar, Dhaka 1215</div>
    <div><strong>Chattogram Office</strong>Agrabad Commercial Area<br>Chattogram 4100, Bangladesh</div>
    <div><strong>Contact</strong>info@tfsbd.com<br>www.tfsbd.com</div>
  </div>
  <div class="social-links">
    <a class="social-link" href="https://linkedin.com/company/tfsbd" target="_blank">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="currentColor"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-4 0v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></svg> LinkedIn
    </a>
    <a class="social-link" href="https://facebook.com/tfsbd" target="_blank">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg> Facebook
    </a>
    <a class="social-link" href="https://youtube.com/@tfsbd" target="_blank">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="currentColor"><path d="M22.54 6.42a2.78 2.78 0 00-1.95-1.96C18.88 4 12 4 12 4s-6.88 0-8.59.46a2.78 2.78 0 00-1.95 1.96A29 29 0 001 12a29 29 0 00.46 5.58A2.78 2.78 0 003.41 19.54C5.12 20 12 20 12 20s6.88 0 8.59-.46a2.78 2.78 0 001.95-1.96A29 29 0 0023 12a29 29 0 00-.46-5.58z"/></svg> YouTube
    </a>
  </div>
</div>`;
}

// Action buttons
function onView(){
  if(!validate()){showToast('⚠ Please fill mandatory fields (Sender, Receiver, :20:, :40A:, :50:, :59:)','#b7791f');return;}
  document.getElementById('draft-document').innerHTML=buildDraftHTML(collectAllFields());
  document.getElementById('preview-modal').classList.add('active');
}

function onSave(){
  if(!validate()){showToast('⚠ Please fill mandatory fields first','#b7791f');return;}
  const d=collectAllFields();
  let txt=`TFSBD – SWIFT MESSAGE GENERATOR – DRAFT COPY\n${'='.repeat(60)}\nMessage Type: ${d.mt}\nSender BIC  : ${d.senderBIC}\nReceiver BIC: ${d.recvSwift}\nGenerated   : ${new Date().toISOString()}\n${'='.repeat(60)}\n\n`;
  txt+=`{1:F01${d.senderBIC}0000000000}\n{2:I${d.mt}${d.recvSwift}N}\n{4:\n`;
  d.fields.forEach(f=>{txt+=`:${f.tag}:${f.value}\n`;});
  txt+=`-}\n\n${'='.repeat(60)}\nOwned and operated by Trade Finance Solution Bangladesh (TFSBD)\ninfo@tfsbd.com | www.tfsbd.com\n`;
  const blob=new Blob([txt],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download=`TFSBD_Draft_${d.mt}_${Date.now()}.txt`;a.click();
  URL.revokeObjectURL(url);
  showToast('✅ Draft saved as TXT file.');
}

function onPrint(){
  if(!validate()){showToast('⚠ Please fill mandatory fields first','#b7791f');return;}
  const d=collectAllFields();
  const win=window.open('','_blank','width=900,height=700');
  win.document.write(`<!DOCTYPE html><html><head>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=IBM+Plex+Mono:wght@400&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet"/>
<style>
body{margin:0;font-family:'IBM Plex Sans',sans-serif;background:white}
:root{--navy:#0a1628;--navy2:#132040;--gold:#c9a84c;--muted:#6b7280}
.draft-header{background:var(--navy);padding:20px 28px;display:flex;align-items:center;gap:14px}
.draft-logo{width:42px;height:42px;background:var(--gold);border-radius:7px;display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-weight:700;color:var(--navy);font-size:16px}
.draft-header-text strong{font-family:'Playfair Display',serif;font-size:14px;color:white;display:block}
.draft-header-text span{font-size:10px;color:rgba(255,255,255,.45);letter-spacing:1.5px;text-transform:uppercase}
.draft-watermark{background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.25);padding:5px;text-align:center;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#856404;font-family:'IBM Plex Mono',monospace}
.draft-content{padding:18px 28px}
.draft-meta{display:flex;gap:14px;margin-bottom:12px;flex-wrap:wrap}
.draft-meta-item{font-size:10px;color:var(--muted)}
.draft-meta-item strong{color:var(--navy);display:block;font-size:9px;text-transform:uppercase;letter-spacing:.5px}
.swift-block{font-family:'IBM Plex Mono',monospace;font-size:10.5px;background:var(--navy);color:#e2f0ff;padding:14px 18px;border-radius:8px;white-space:pre-wrap;word-break:break-word;line-height:1.75;border-left:4px solid var(--gold)}
.draft-footer{background:var(--navy2);padding:14px 28px;border-top:1px solid rgba(201,168,76,.12)}
.draft-footer-top{font-size:10px;color:rgba(255,255,255,.5);margin-bottom:7px;font-style:italic}
.draft-footer-addr{display:flex;gap:20px;margin-bottom:8px;flex-wrap:wrap}
.draft-footer-addr div{font-size:9.5px;color:rgba(255,255,255,.4);line-height:1.7}
.draft-footer-addr strong{color:rgba(255,255,255,.65);display:block;font-size:8.5px;text-transform:uppercase;letter-spacing:.8px}
.social-links{display:flex;gap:7px}
.social-link{font-size:9.5px;color:rgba(255,255,255,.4);text-decoration:none;padding:3px 7px;border:1px solid rgba(255,255,255,.12);border-radius:3px}
@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact}}
</style></head><body>`);
  win.document.write(buildDraftHTML(d));
  win.document.write('</body></html>');
  win.document.close();
  setTimeout(()=>{win.focus();win.print();},700);
}

function onSendClick(){
  if(!validate()){showToast('⚠ Please fill mandatory fields first','#b7791f');return;}
  document.getElementById('send-modal').classList.add('active');
}

function onSendConfirm(){
  const email=document.getElementById('send-to-email').value.trim();
  const emailRx=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const fg=document.getElementById('fg-send-to');
  fg.classList.toggle('has-error',!emailRx.test(email));
  if(!emailRx.test(email)) return;
  const d=collectAllFields();
  let body=`TFSBD SWIFT Message Generator – Draft Copy\n\nMessage Type: ${d.mt}\nSender BIC: ${d.senderBIC}\nReceiver BIC: ${d.recvSwift}\n\n--- SWIFT MESSAGE ---\n{1:F01${d.senderBIC}0000000000}\n{2:I${d.mt}${d.recvSwift}N}\n{4:\n`;
  d.fields.forEach(f=>{body+=`:${f.tag}:${f.value}\n`;});
  body+=`-}\n\n--- END ---\n\nGenerated by TFSBD Swift Message Generator\ninfo@tfsbd.com | www.tfsbd.com\nOwned and operated by Trade Finance Solution Bangladesh (TFSBD).`;
  const subject=encodeURIComponent(`[TFSBD] Draft SWIFT ${d.mt} – ${new Date().toISOString().slice(0,10)}`);
  window.location.href=`mailto:${email}?cc=info@tfsbd.com&subject=${subject}&body=${encodeURIComponent(body)}`;
  closeModal('send-modal');
  showToast('✅ Draft SWIFT message sent successfully.');
}
</script>
</body>
</html>